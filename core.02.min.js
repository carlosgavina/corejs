/* core.js v0.2 by @carlosgavina : hello@carlosgavina.com */
(function(y,u){var r={typeOf:function(b){var d=typeof b;"object"===d&&null===b&&(null===b?d="null":"number"===typeof b.length&&(d="array"));return d},merge:function(b,d){var c={},a="object"===r.typeOf(b)?b:null,g="object"===r.typeOf(d)?d:null,m;if(a)for(m in a)c[m]=a[m];if(g)for(m in g)c[m]=g[m];return c}},h={_:{},Apps:{},Object:function(b){var d=this,c=r.typeOf,a=document.createElement("p"),g={_:{_:$(a)}},m=function(a,d,f){var b;d="string"===c(d)?d:"_";f="boolean"===c(f)?f:!0;if("string"===c(a)){b=
a.split(":");1===b.length?(a="_",b=b[0]):(a=b[0],b=b[1]);if("object"!==c(g[a])&&!0===f)g[a]={};else if("object"!==c(g[a]))return;if("object"!==c(g[a][d])&&!0===f)g[a][d]=$(document.createElement("p"));else if("object"!==c(g[a][d]))return;return{context:d,name:b,hub:g[a],event:g[a][d]}}};this._={};this._.clone=function(){Object.create||function(a){function d(){}d.prototype=a;return new d}};this._.implement=function(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(d[b]=a[b]);return d};instance=this._.clone(this);
b&&this._.implement.call(instance,b);this.on=function(a,b,f){b="function"===typeof b?b:void 0;a=m(a,f);if("object"===c(a)&&"function"===c(b))a.event.on(a.name,b);return d};this.trigger=function(a,b,f){var k="string"===c(f)?f:"all";a=m(a,f,!1);if("object"===c(a))if("all"===k)for(var e in a.hub)a.hub[e].trigger(a.name,b);else a.event.trigger(a.name,b);return d};this.off=function(a,b){var f="string"===c(b)?b:"all",k=m(a,b,!1),e,j;if(void 0!==k)if(e=a.split(":"),e=1===e.length?null:k.name,"all"===f)for(j in k.hub)k.hub[j].off(e);
else k.event.off(e);else for(j in g)for(e in g[j])g[j][e].off();return d};return instance},Cache:function(b){var d={},c={},a={history:[],size:10,localStorage:!1,id:null},g=function(){var b;if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&"undefined"!==typeof localStorage)try{b=JSON.stringify(a.history),localStorage.setItem(a.id,b),d.trigger("LocalStorage:Save",{id:a.id,data:a.history})}catch(c){}};if("object"===typeof b)for(var m in b)a[m]=b[m];var n;
if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&"undefined"!==typeof localStorage)try{n=JSON.parse(localStorage.getItem(a.id)),"object"===typeof n&&void 0!==n.length&&(a.history=n)}catch(p){}c={add:function(b){var c=a.history.length,e=a.size;"undefined"!==typeof b&&("object"==typeof b&&b.length?(a.history=a.history.concat(b),c=a.history.length,c>=e&&a.history.splice(0,c-e)):(c>=e&&a.history.shift(),a.history.push(b)));g();return d},get:function(){return a.history},
remove:function(b){var d=a.history,e=a.history.length,c=!1;if("undefined"!==typeof b)for(;e--;)if(d[e]===b){a.history.splice(e,1);c=!0;break}g();return c},exists:function(b){var d=a.history,c=a.history.length;if("undefined"!==typeof b)for(;c--;)if(d[c]===b)return c;return!1},addUnique:function(b){var c=a.history,e=a.history.length;if("undefined"!==typeof b)for(;e--;)if(c[e]===b){a.history.splice(e,1);break}a.history.push(b);g();return d},setMaxSize:function(b){a.size="number"===typeof b?b:detaults.size;
return d},resetCache:function(){a.history=[];g()},removeAtIndex:function(b){if("number"===typeof b)return b<a.history.length?(a.history.splice(b,1),!0):!1;g()},setLocalStorage:function(b){a.localStorage="boolean"===typeof b?b:a.localStorage}};return d=new h.Object(c)},Api:function(b){var d,c={},a=r.typeOf,g=r.merge,m={protocol:"http://",timeout:1E4,async:!0},n={},p={},f=function(a,b,c,e){c.success=function(a){e.trigger("Success",a);d.trigger("Success",a)};c.error=function(a,b){var c={error:{id:2,
description:b,response:a.response,xhr:a}},f="Error";if("timeout"===b||"Timeout"===b)f="Timeout";e.trigger(f,c);d.trigger(f,c)};c.type=a;c.url=c.protocol+p.url+b.endpoint;a=$.ajax(c);e.request=a;return e},k=function(b,c,e){var f=null,j="Unknown";"string"===a(b)&&"object"===a(n[b])?(b="object"===a(n[b].options)?n[b].options:null,f=g(m,b),f=g(f,c)):("string"===a(b)&&(j=b),e.trigger("Error",{error:{id:1,description:"Request '"+j+"' doesn't exist."}}),d.trigger("Error",{error:{id:1,description:"Request '"+
j+"' doesn't exist."}}));return f},e;for(e in b)if("requests"!==e&&"url"!==e)m[e]=b[e];else if("requests"===e){var j=b[e];if("object"===a(j)){var l=void 0;for(l in j){var s=l,q=j[l];"string"===a(q.endpoint)&&(n[s]=q)}}else"string"===a(j)&&"string"===a(void 0)&&"string"===a((void 0).endpoint)&&(n[j]=void 0)}else"url"===e&&(p[e]=b[e]);c.post=function(a,b){var c=new h.Object,d=k(a,b,c);d&&f("POST",n[a],d,c);return c};c.get=function(a,b){var c=new h.Object,d=k(a,b,c);d&&f("POST",n[a],d,c);return c};return d=
new h.Object(c)},Controller:function(b){var d=r.typeOf;b="object"===d(b)?b:{};var c="string"===d(b.appname)?b.appname:null;c&&"object"===d(h.Apps[c])?b.app=h.Apps[c]:"object"===d(h._)&&"object"===d(h._.defapp)&&(b.app=h._.defapp);b=new h.Object(b);"function"===d(b.init)&&b.init(b);return b},Data:function(b){return new function(){var d={},c,a={},g="object"===typeof b?b:{};(g="object"===typeof g.attributes?g.attributes:null)&&(a=g);return function(b){var g=null,p=null,f=a,k="object"===typeof b?b:{};
b="string"===typeof k.storageID?k.storageID:null;k="object"===typeof k.data?k.data:null;b&&(g=b,p=new h.Cache({size:1,id:b,localStorage:!0}));"object"===typeof k&&null!==k?(f=k,p&&p.add(f)):p&&(b=p.get()[0],"undefined"!==typeof b&&(f=p.get()[0]));d={get:function(a){return"string"===typeof a?f[a]:f},set:function(a,b){return"object"===typeof a?(f=a,c.trigger("Change",{Data:c,newdata:a}),c):"string"===typeof a?(f[a]=b,c.trigger("Change:"+a,{Data:c,id:a,newdata:b}),c):!1},save:function(a){if(a="string"===
typeof a&&0<a.length?a:g)p||(p=new h.Cache({size:1,id:a,localStorage:!0})),p.add(f)},attributes:f};return c=new h.Object(d)}}},Microtemplate:function(b){var d=/\{{([^}]+)\}}/g,c={render:function(b){b="object"===typeof b?b:{};b="object"===typeof b.variables?b.variables:void 0;b="object"===typeof b?b:"object"===typeof a.arg.variables?a.arg.variables:null;var g,h,f,k;g=a.template;var e=document.createElement(a.elType);if(b&&"string"===typeof g){h=g.match(d);if(null!==h)for(var j=f=h.length;j--;)f=h[j],
k=h[j].slice(2,h[j].length-2),g=g.replace(f,b[k]);a.rendered=g;e.innerHTML=g;a.el=$(g);c.onDone()}else"string"===typeof g&&(a.rendered=g,e.innerHTML=g,a.el=$(g),c.onDone());return a},onDone:function(){"function"===typeof a.arg.render&&a.arg.render(a)},getT:function(b){"undefined"!==typeof("string"===typeof a.template?a.template:void 0)&&!1===b?("function"===typeof a.arg.loaded&&a.arg.loaded(a),"function"===typeof c.onDone&&c.render(a)):"string"===typeof a.url&&$.ajax({url:a.url+"?v="+a.version,async:!0,
success:function(b){a.template=b;a.el=$(b);"function"===typeof a.arg.loaded&&a.arg.loaded(a);"function"===typeof c.onDone&&c.render(a.template)},error:function(){return null}})}},a={elType:"div",arg:b,url:void 0,template:void 0,rendered:void 0,version:0,render:c.render},g="boolean"===typeof b.force?b.force:!1;a.arg=b;"string"===typeof b.html?(a.template=b.html,"function"===typeof b.loaded&&b.loaded(a),c.render()):"string"===typeof b.url&&(a.url=b.url,c.getT(g));a.version="number"===typeof b.version?
b.version:"object"===typeof h._&&"object"===typeof h._.defapp&&"object"===typeof h._.defapp.config&&"object"===typeof h._.defapp.config.versions&&"number"===typeof h._.defapp.config.versions.templates?h._.defapp.config.versions.templates:1;return a},View:function(b){return new function(){var d=new h.Object,c={},a,g,m=function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===typeof a.ownerDocument}},n=function(b){var e,
h="object"===typeof b?b:{},j="function"===typeof h.onSuccess?h.onSuccess:function(){};gatherElements=function(a){if(f){f.html(a);for(var b in c)k[b]=f.find(c[b])}d.elements=k};if(!0===g)e=a.render(b),d.template=e,gatherElements(e.el),j(d),d.trigger("TemplateRendered",d);else d.on("TemplateReady",function(a,b){e=b;d.template=e;gatherElements(e.el);j(d);(void 0).trigger("TemplateRendered",d)});return d},p=function(a,b){var c="string"===typeof a?a:null,e="string"===typeof b||"number"===typeof b?b:"",
f,g=null,h;c&&(c=c.split(":"),f=c[0],"string"===typeof c[1]&&(g=c[1]),"undefined"!==typeof k[f]&&m(k[f][0])?h=k[f]:"string"===f&&(h=$(f)),null===g?h.html(e):h.attr(g,e));return d},f=null,k={},e=h,j=e.Apps,l="object"===typeof b?b:{},s="string"===typeof l.html?l.html:null,q="string"===typeof l.url?l.url:null,r="string"===typeof l.storageID?l.storageID:null,v="boolean"===typeof l.appstorage?l.appstorage:!0,t="string"===typeof l.appname?l.appname:null;g=!1;!0===v&&r&&(!t&&"object"===typeof e._.defapp&&
(t=e._.defapp.name),t&&("object"===typeof j&&"object"===typeof j[t])&&(e=j[t],e._.getTemplate(r,{url:q,html:s,loaded:function(b){a=b;g=!0;d.trigger("TemplateReady",a)}})));c="object"===typeof l.elements?l.elements:{};return function(a){a="object"===typeof a?a:{};f="object"===typeof a.el&&m(a.el[0])?a.el:"string"===typeof a.el?$(a.el):null;d.el=f;d.render=n;d.update=p;d.elements=k;d.events=void 0;return d}}},App:function(b){var d=new h.Object,c={Router:{Default:""}},a={},g={},m=h.Microtemplate,n=function(b,
d,f){var e="object"===typeof a.Templates.get()[0]?a.Templates.get()[0]:!1,g=c.versions.templates;if(!e||"object"!==typeof e.templates)e={templates:{}},e.version=g;e.templates[b]={version:f,html:d};a.Templates.add(e)},p=function(a){var b=g;a=a.split("/");var c=!1,d={};""===a[0]&&a.splice(0,1);""===a[a.length-1]&&(a=a.splice(a.length-1,1));request_split_len=a.length;for(var e in b){if(request_split_len===b[e].len){for(var c=!0,f=0;f<request_split_len;f++)a[f].toLowerCase()!==b[e].split[f].toLowerCase()&&
(c=!1);if(!1===c)for(f=0;f<request_split_len;f++)a[f].toLowerCase()===b[e].split[f].toLowerCase()||void 0!==b[e].variables[f]?(void 0!==b[e].variables[f]&&(d[b[e].variables[f]]=a[f]),c=!0):c=!1}if(!0===c)return{key:e,variables:d}}return!1},f="object"===typeof b?b:{};b="string"===typeof f.name?f.name:Math.random().toString(36).substring(7);var k="undefined"!==typeof f.el&&isElement(f.el[0])?f.el:$("body"),e="boolean"===typeof f.localStorage?f.localStorage:!1,j="object"===typeof f.versions?f.versions:
{},l=b+"_data";j.templates="number"===typeof j.templates?j.templates:1;j.data="number"===typeof j.data?j.data:1;if(f)for(var s in f)c[s]=f[s];c.versions=j;a.Templates=new h.Cache({size:1,id:b+"_templates",localStorage:e});a.Data=new h.Cache({size:1,id:l,localStorage:e});h._.defapp=d;h.Apps[b]=d;s=c.Router;var f={},q,r,v={},t,u=/\{([^}]+)\}/g;if("object"===typeof s){for(var x in s){e=s[x];l=e.split("/");""===l[0]&&l.splice(0,1);""===l[l.length-1]&&(l=l.splice(l.length-1,1));r=l.length;q=e.match(u);
j=[];if(q)for(var w=t=0;w<r;w++)q=l[w].match(u)?l[w]:void 0,void 0!==q?(q=q.substr(1,q.length-2),j.push(q),v[q]=void 0,t++):j.push(void 0);f[x]={route:e,len:r,split:l,variables:j,varkeys:v}}g=f}d.el=k;d.name=b;d.services={};d.start=function(){var a=function(a){var b=a.substr(1,a.length-1);a=""===a?{key:"Default",variables:{}}:p(b);d.trigger("Router:"+a.key,a.variables)};if("onhashchange"in window)window.onhashchange=function(){a(window.location.hash)};else{var b=window.location.hash,c;window.setInterval(function(){window.location.hash!=
b&&(c=window.location.hash,a(c))},100)}a(window.location.hash);return d};d.config=c;d.translateRoute=p;d.Data="object"===typeof c.Data?c.Data:{};d.Views="object"===typeof c.Views?c.Views:{};d._={saveTemplate:n,getTemplate:function(b,d){var f="object"===typeof d?d:{},e="object"===typeof a.Templates.get()[0]?a.Templates.get()[0]:!1,g=c.versions.templates,h="number"===typeof f.version?f.version:1,j="function"===typeof d.loaded?d.loaded:!1,f=!0;if(e)if("number"===typeof e.version&&e.version===g){if("object"===
typeof e.templates&&"object"===typeof e.templates[b]){f=!1;var e=e.templates[b],g="string"===typeof e.html?e.html:"...",k="function"===typeof d.loaded?d.loaded:!1;("number"===typeof e.version?e.version:1)===h?(d.url=null,d.html=g):d.loaded=function(a){n(b,a.template,h);k&&k(a)};e=new m(d);return e}}else a.Templates.resetCache();if(!0===f)return d.loaded=function(a){n(b,a.template,h);j&&j(a)},new m(d,!0)},saveData:function(){},getData:function(){}};return d}};"function"===typeof define&&define.amd?
define("Core",[],function(){return h}):"undefined"!==typeof module&&"undefined"!==typeof exports&&module.exports?module.exports=h:y["string"===typeof u?u:"Core"]=h})(this,"$$");
