/* core.js v0.3.2b by @carlosgavina | hello@carlosgavina.com | https://github.com/carlosgavina/corejs */
(function(C,w){Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}};var q={typeOf:function(a){var b=typeof a;"object"===b&&null===a&&(null===a?b="null":"number"===typeof a.length&&(b="array"));return b},clone:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor(),c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},merge:function(a,b){var c={},d="object"===q.typeOf(a)?a:null,e="object"===q.typeOf(b)?b:null,h;if(d)for(h in d)d.hasOwnProperty(h)&&
(c[h]=d[h]);if(e)for(h in e)e.hasOwnProperty(h)&&(c[h]=e[h]);return c},isElement:function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===typeof a.ownerDocument}},musthashRender:function(a,b){var c=/\{{([^}]+)\}}/g,d=q.typeOf,e=a,h;if("object"===d(b)&&(c=e.match(c),null!==c))for(var j=d=c.length;j--;)d=c[j],h=c[j].slice(2,c[j].length-2),e=e.replace(d,b[h]);return e},appChooser:function(a){var b=q.typeOf,c=l,d=c._,c=c.Apps;
a="string"===b(a)?a:null;var e=null;!a&&"object"===b(d.defapp)&&(a=d.defapp.name);a&&("object"===b(c)&&"object"===b(c[a]))&&(e=c[a]);return e}},l={_:{},Apps:{},Tools:q,Object:function(a){var b=this,c=q.typeOf,d;d=document.createElement("p");var e={_:{_:$(d)}},h={},j=function(b,n,a){var d;n="string"===c(n)?n:"_";a="boolean"===c(a)?a:!0;if("string"===c(b)){d=b.split(":");1===d.length?(b="_",d=d[0]):(b=d[0],d=d[1]);if("object"!==c(e[b])&&!0===a)e[b]={};else if("object"!==c(e[b]))return;if("object"!==
c(e[b][n])&&!0===a)e[b][n]=$(document.createElement("p"));else if("object"!==c(e[b][n]))return;return{context:n,name:d,hub:e[b],event:e[b][n]}}};this._={};this._.clone=function(){Object.create||function(b){function c(){}c.prototype=b;return new c}};this._.implement=function(c){if(c)for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);return b};d=this._.clone(this);a&&this._.implement.call(d,a);this.on=function(d,a,e){a="function"===typeof a?a:void 0;d=j(d,e);if("object"===c(d)&&"function"===c(a))d.event.on(d.name,
$.proxy(a,b));return b};this.trigger=function(d,a,e){var f="string"===c(e)?e:"all";d=j(d,e,!1);if("object"===c(d))if("all"===f){var f=d.hub,m;for(m in f)f.hasOwnProperty(m)&&f[m].trigger(d.name,a)}else d.event.trigger(d.name,a);return b};this.off=function(d,a){var p="string"===c(a)?a:"all",f=j(d,a,!1),m,g;if(void 0!==f)if(m=d.split(":"),m=1===m.length?null:f.name,"all"===p)for(g in p=f.hub,p)p.hasOwnProperty(g)&&p[g].off(m);else f.event.off(m);else for(g in e)if(e.hasOwnProperty(g))for(m in e[g])e[g].hasOwnProperty(m)&&
e[g][m].off();return b};this.close=function(d){var a="object"===c(d)?d:{};d="boolean"===c(a.clearData)?a.clearData:!0;a="boolean"===c(a.closeData)?a.closeData:!0;b.trigger("Before:Close");if(!0===a){var a=h,e;for(e in a)if("object"===c(a[e]))if("function"===c(a[e].close))a[e].close();else for(var f in a[e])"object"===c(a[e][f])&&"function"===c(a[e][f].close)&&a[e][f].close()}!0===d&&b.data(null);b.off()};this.data=function(a,d){if("undefined"===c(d)&&"string"===c(a))return h[a];if("string"===c(a))h[a]=
d;else if(null===a)h={};else if("undefined"===c(a))return h;return b};return d},Cache:function(a){var b={},c={},d={history:[],size:10,localStorage:!1,id:null},e=function(){var a;if("boolean"===typeof d.localStorage&&("string"===typeof d.id&&!0===d.localStorage&&0<d.id.length)&&"undefined"!==typeof localStorage)try{a=JSON.stringify(d.history),localStorage.setItem(d.id,a),b.trigger("LocalStorage:Save",{id:d.id,data:d.history})}catch(c){}};if("object"===typeof a)for(var h in a)a.hasOwnProperty(h)&&(d[h]=
a[h]);var j;if("boolean"===typeof d.localStorage&&("string"===typeof d.id&&!0===d.localStorage&&0<d.id.length)&&"undefined"!==typeof localStorage)try{j=JSON.parse(localStorage.getItem(d.id)),"object"===typeof j&&void 0!==j.length&&(d.history=j)}catch(q){}c={add:function(a){var c=d.history.length,f=d.size;"undefined"!==typeof a&&("object"==typeof a&&a.length?(d.history=d.history.concat(a),c=d.history.length,c>=f&&d.history.splice(0,c-f)):(c>=f&&d.history.shift(),d.history.push(a)));e();return b},get:function(){return d.history},
remove:function(b){var a=d.history,c=d.history.length,m=!1;if("undefined"!==typeof b)for(;c--;)if(a[c]===b){d.history.splice(c,1);m=!0;break}e();return m},exists:function(b){var a=d.history,c=d.history.length;if("undefined"!==typeof b)for(;c--;)if(a[c]===b)return c;return!1},addUnique:function(a){var c=d.history,f=d.history.length;if("undefined"!==typeof a)for(;f--;)if(c[f]===a){d.history.splice(f,1);break}d.history.push(a);e();return b},setMaxSize:function(a){d.size="number"===typeof a?a:10;return b},
resetCache:function(){d.history=[];e()},removeAtIndex:function(b){if("number"===typeof b)return b<d.history.length?(d.history.splice(b,1),!0):!1;e()},setLocalStorage:function(b){d.localStorage="boolean"===typeof b?b:d.localStorage}};return b=new l.Object(c)},Api:function(a){var b,c={},d=q.typeOf,e=q.merge,h={protocol:"http://",timeout:1E4,async:!0},j={},r={},n=function(a,c,d,e){d.success=function(a){e.trigger("Success",a);b.trigger("Success",a)};d.error=function(a,c){var d={error:{id:2,description:c,
response:a.response,xhr:a}},f="Error";if("timeout"===c||"Timeout"===c)f="Timeout";e.trigger(f,d);b.trigger(f,d)};d.type=a;d.url=d.protocol+r.url+c.endpoint;a=$.ajax(d);e.request=a;return e},p=function(a,c,f){var k=null,m="Unknown";"string"===d(a)&&"object"===d(j[a])?(a="object"===d(j[a].options)?j[a].options:null,k=e(h,a),k=e(k,c)):("string"===d(a)&&(m=a),f.trigger("Error",{error:{id:1,description:"Request '"+m+"' doesn't exist."}}),b.trigger("Error",{error:{id:1,description:"Request '"+m+"' doesn't exist."}}));
return k},f;for(f in a)if("requests"!==f&&"url"!==f)h[f]=a[f];else if("requests"===f){var m=a[f];if("object"===d(m)){var g=void 0;for(g in m)if(m.hasOwnProperty(g)){var k=g,v=m[g];"string"===d(v.endpoint)&&(j[k]=v)}}else"string"===d(m)&&"string"===d(void 0)&&"string"===d((void 0).endpoint)&&(j[m]=void 0)}else"url"===f&&(r[f]=a[f]);c.post=function(a,b){var c=new l.Object,d=p(a,b,c);d&&n("POST",j[a],d,c);return c};c.get=function(a,b){var c=new l.Object,d=p(a,b,c);d&&n("GET",j[a],d,c);return c};return b=
new l.Object(c)},Controller:function(a){var b=q.typeOf;a="object"===b(a)?a:{};var c="string"===b(a.appname)?a.appname:null;c&&"object"===b(l.Apps[c])?a.app=l.Apps[c]:"object"===b(l._)&&"object"===b(l._.defapp)&&(a.app=l._.defapp);a=new l.Object(a);"function"===b(a.init)&&a.init(a);return a},Data:function(a){var b,c=q.typeOf,d=q.merge,e={},h=!1,j={},r=!1,n=!1,p=function(a,m){var g="object"===c(m)?m:{},j="string"===c(g.request)?g.request:"string"===c(e.request)?e.request:null,h="object"===c(e.app.Api)?
e.app.Api:null,l,n,p,q="string"===c(g.method)?g.method:null,t="object"===c(g.data)?g.data:null,x;!q&&"push"===a?(q="post",x="Push",n="boolean"===c(g.update)?g.update:!1,p="boolean"===c(g.merge)?g.merge:!1,l="string"===c(e.pushkey)?e.pushkey:null):!q&&"pull"===a&&(q="get",x="Pull",n="boolean"===c(g.update)?g.update:!0,p="boolean"===c(g.merge)?g.merge:!0,l="string"===c(e.pullkey)?e.pullkey:null);null===t&&(t="object"===c(b.attributes)?b.attributes:{});g.data=t;j&&h&&(g=h[q](j,g),g.on("Success",function(a,
e){t=l&&"undefined"!==c(e[l])?e[l]:e;!0===p&&(t=d(t,b.attributes));!0===n&&(b.set(t),f("Data:Available",t));f(x+":Success",t)}),g.on("Error",function(a,b){f(x+":Error",b)}),g.on("Timeout",function(a,b){f(x+":Timeout",b)}));return b},f=function(a,d){b.trigger(a,d);h&&"function"===c(j[a])&&j[a].bind(b)(d)};a="object"===c(a)?a:{};var m="string"===c(a.appname)?a.appname:null,g="object"===c(this.config)?this.config:{},g=d(g,a),e=d(g,{attributes:{}});m&&"object"===c(l.Apps[m])?e.app=l.Apps[m]:"object"===
c(l._)&&"object"===c(l._.defapp)&&(e.app=l._.defapp);e.id&&e.attributes&&!n&&(n=new l.Cache({size:1,id:e.id,localStorage:!0}),n.get()[0]!=={}||""!==n.get()[0]?e.attributes=n.get()[0]:n.add(e.attributes),r=!0);e.set=function(a,d){if("object"===typeof a)b.attributes=a,f("Change",{newdata:a});else if("string"===typeof a)"object"!==c(b.attributes)&&(b.attributes={}),b.attributes[a]=d,f("Change:"+a,{newdata:d});else return!1;var g="string"===c(e.id)?e.id:null;g&&(n||(n=new l.Cache({size:1,id:g,localStorage:!0})),
n.add(b.attributes));return b};e.get=function(a){var d=b.attributes;return"string"===c(a)&&"object"===c(b.attributes)?d[a]:d};e.pull=function(a){return p("pull",a)};e.push=function(a){return p("push",a)};e.config=g;"object"===c(g.events)&&(h=!0,j=g.events);b=new l.Object(e);"function"===c(b.init)&&b.init(b);!0===r&&("undefined"!==c(b.attributes)&&b.attributes!=={})&&f("Data:Available",b.attributes);return b},Microtemplate:function(a){var b,c=!1,d=q,e=d.typeOf,h=d.isElement,j=d.appChooser,r=d.musthashRender,
n,p=function(a){a="object"===e(a)?a:{};var d="object"===e(a.variables)?a.variables:null,f="object"===e(a.el)&&h(a.el[0])?a.el:null,g=function(a){b.result=r(a,d);b.el=$(b.result);f&&f.html(b.el);b.trigger("Rendered")};if(!0===c)g(b.html);else b.on("Ready",function(){g(b.html)})},f=function(a,d){var f="boolean"===e(d)?d:!1;void 0!==b?(b.config.html=a,b.html=a):m.html=a;c=!0;!0===f&&g(null,!0)},m={config:{version:1,use_app_storage:!0},html:"",render:p,result:"",el:void 0},g=function(a,d){var c="object"===
e(a)?a:null,f,g,k;g=c=void 0!==b?b.config:m.config;"string"===e(c.id)&&(!0===c.use_app_storage?(f=j(c.appname))&&(k=f._.getTemplate(c.id)):(n=new l.Cache({size:1,id:c.id,localStorage:!0}),k=n.get()[0]),void 0===k||!0===d?!0===c.use_app_storage?f._.saveTemplate(c.id,c):n.add(c):k.version!==c.version?(!0===c.use_app_storage?f._.saveTemplate(c.id,c):n.add(c),g=c):g=k);return g},d=e(a)?a:{};a={};for(var k in d)d.hasOwnProperty(k)&&(m.config[k]=d[k]);a=g();"string"===e(a.html)?f(a.html):"string"===e(a.url)?
(k={},k.url=a.url+"?v"+a.version,k.success=function(a){f(a,!0);b.trigger("Ready")},k.error=function(a){b.trigger("Error",{error:a})},$.ajax(k)):"object"===e(a.el)&&h(a.el[0])&&f(a.el.html());b=new l.Object(m);!0===c&&b.trigger("Ready");"function"===e(b.init)&&b.init(b);b.on("Render",function(a,b){p(b)});return b},View:function(a){var b=q,c=b.typeOf,d=b.isElement,b=b.merge,e,h={elements:{}},j={},r=function(a,b){var g=d(a[0])?a:e.template.el,k="object"===c(b)?b:"object"===c(j.elements)?j.elements:null;
if(k)for(var h in k)k.hasOwnProperty(h)&&(e.elements[h]=g.find(k[h]))},n=function(a){var b=e.template,g="object"===c(a)?a:{},k="object"===c(g.el)&&d(g.el[0])?g.el:null;b&&(b.off("Rendered","thisview"),b.on("Rendered",function(){k&&(k.html(this.el),r(k));e.update=p;e.trigger("Template:Rendered");"object"===c(j.events)&&"function"===c(j.events["Template:Rendered"])&&j.events["Template:Rendered"].bind(e)()},"thisview"),b.render(a));return e},p=function(a,b){var g="object"===c(e.elements)?e.elements:
null,k="string"===typeof a?a:null,j="string"===typeof b||"number"===typeof b?b:"",h,l;g&&k&&(k=k.split(":"),a=k[0],"string"===typeof k[1]&&(h=k[1]),"undefined"!==typeof g[a]&&d(g[a][0])?l=g[a]:"string"===a&&(l=$(a)),"object"===c(l)&&d(l[0])&&(null===h||void 0===h?l.html(j):l.attr(h,j)));return e};a=c(a)?a:{};j="object"===c(this.config)?this.config:{};j=b(j,a);h.template=!0===j.extended&&"object"===c(j.template)&&"object"===c(j.template.config)?new $$.Microtemplate(j.template.config):"object"===c(j.template)?
j.template:null;h.render=n;h.gatherElements=r;e=new l.Object(h);"function"===c(e.init)&&e.init(e);e.on("Render",function(a,b){n(b)});return e},App:function(a){var b=new l.Object,c=q,d=c.typeOf,e=c.isElement,c={Router:{Default:""}},h,j={},r,n=function(a,c,e){var f;c="boolean"===d(c)?c:!1;e="boolean"===d(e)?e:!1;var g=f;f=a.substr(1,a.length-1);!1===c&&(g=f);!0===b.config.pushState?r!==f&&(r=f,!0===c?(g=window.location.href.replace(location.protocol+"//"+b.url,""),a=p(g),!0===e&&(g=g.replace("/#/",
""),g=g.replace("#/",""),g=g.replace("#",""),""===g&&(g="/"),window.history.pushState(a.variables,b.name,g))):(a=p(f),window.history.pushState(a.variables,b.name,g)),b.trigger("Router:BeforeRouter"),b.trigger("Router:"+a.key,a.variables)):(a=p(f),b.trigger("Router:BeforeRouter"),b.trigger("Router:"+a.key,a.variables))},p=function(a){var b=j;a=a.split("/");var c=!1,d={},e;""===a[0]&&a.splice(0,1);""===a[a.length-1]&&(a=a.splice(0,a.length-1));e=a.length;for(var g in b)if(b.hasOwnProperty(g)&&e===b[g].len){for(var c=
!0,f=0;f<e;f++)a[f].toLowerCase()!==b[g].split[f].toLowerCase()&&(c=!1);if(!1===c){for(f=0;f<e;f++)a[f].toLowerCase()===b[g].split[f].toLowerCase()&&void 0===b[g].variables[f]?c=!0:a[f].toLowerCase()!==b[g].split[f].toLowerCase()&&void 0!==b[g].variables[f]?(c=!0,d[b[g].variables[f]]=a[f]):c=!1;return!0===c?{key:b[g].event,variables:d}:{key:"Default",variables:void 0}}}return{key:"Default",variables:void 0}},f="object"===d(a)?a:{};a="string"===d(f.name)?f.name:Math.random().toString(36).substring(7);
var e="object"===d(f.el)&&e(f.el[0])?f.el:$("body"),m="boolean"===typeof f.localStorage?f.localStorage:!0,g="object"===typeof f.versions?f.versions:{},k=a+"_templates",v=a+"_data";g.templates="number"===typeof g.templates?g.templates:1;g.data="number"===typeof g.data?g.data:1;if(f)for(var u in f)f.hasOwnProperty(u)&&(c[u]=f[u]);c.versions=g;h=new l.Cache({size:1,id:k,localStorage:m});new l.Cache({size:1,id:v,localStorage:m});l._.defapp=b;l.Apps[a]=b;u=c.Router;var f={},s,w={},A,B=/\{([^}]+)\}/g;if("object"===
typeof u){for(var y in u)if(u.hasOwnProperty(y)){m=y;k=m.split("/");""===k[0]&&k.splice(0,1);""===k[k.length-1]&&(k=k.splice(k.length-1,1));v=k.length;s=m.match(B);g=[];if(s)for(var z=A=0;z<v;z++)s=k[z].match(B)?k[z]:void 0,void 0!==s?(s=s.substr(1,s.length-2),g.push(s),w[s]=void 0,A++):g.push(void 0);f[y]={event:u[y],route:m,len:v,split:k,variables:g,varkeys:w}}j=f}b.el=e;b.name=a;b.start=function(){b.trigger("Starting");if(!0===b.config.pushState)window.onpopstate=function(){n(window.location.href,
!0)},n(window.location.href,!0,!0);else{if("onhashchange"in window)window.onhashchange=function(){n(window.location.hash)};else{var a=window.location.hash,c;window.setInterval(function(){window.location.hash!=a&&(c=window.location.hash,n(c))},100)}n(window.location.hash)}b.trigger("Started");b.on("a:click",function(a,c){var e;e=c.url;e="string"===d(e)?e:null;var f="";e?("#"!==e.charAt(0)&&"/"!==e.charAt(0)?f="#/"+e:"/"===e.charAt(0)?f="#"+e:"#"===e.charAt(0)&&"/"!==e.charAt(1)?(f=e.substring(e.length,
2),f="#/"+f):f=e,e=f):e=null;f=c.el;e&&"false"!==f.attr("data-coreroute")&&(!0===b.config.pushState?n(e):window.location=e)});return b};b.config=c;b.url="string"===d(c.url)?c.url:window.location.host;b.config.pushState="boolean"===d(c.pushState)?c.pushState:window.history.pushState?!0:!1;c.Api&&(b.Api=new l.Api(c.Api));"boolean"!==d(c.routerOverrideLinks)&&(c.routerOverrideLinks=!0);b._={saveTemplate:function(a,b){var c=h.get()[0];"object"!==d(c)&&(c={});c[a]=b;h.add(c)},getTemplate:function(a){var b=
h.get()[0];if("object"===d(b))return b[a]}};if(!0===c.routerOverrideLinks)e.on("click",function(a){var c=a.target,d=$(c),e=/(https?:\/\/[^\s]+)/g,f="";if("a"===c.nodeName||"A"===c.nodeName)f=d.attr("href"),f.match(e)?1===f.match(e).length&&(window.location=f):(a.preventDefault(),b.trigger("a:click",{el:d,url:f}))});"function"===d(b.init)&&b.init(b);$(document).ready(function(){b.trigger("Ready")});return b},version:"0.3.2b"};l.View.extend=function(a){var b={};b.config=a;b.config.extended=!0;return l.View.bind(b)};
l.Data.extend=function(a){var b={};b.config=a;b.config.extended=!0;return l.Data.bind(b)};l.Controller.extend=function(a){var b={};b.config=a;b.config.extended=!0;return l.Controller.bind(b)};"function"===typeof define&&define.amd?define("Core",[],function(){return l}):"undefined"!==typeof module&&"undefined"!==typeof exports&&module.exports?module.exports=l:C["string"===typeof w?w:"Core"]=l})(this,"$$");
