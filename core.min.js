/* core.js v0.3.3 by @carlosgavina | hello@carlosgavina.com | https://github.com/carlosgavina/corejs */
(function(C,w){Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}};var s={typeOf:function(a){var b=typeof a;"object"===b&&null===a&&(null===a?b="null":"number"===typeof a.length&&(b="array"));return b},clone:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor(),c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},merge:function(a,b){var c={},d="object"===s.typeOf(a)?a:null,e="object"===s.typeOf(b)?b:null,f;if(d)for(f in d)d.hasOwnProperty(f)&&
(c[f]=d[f]);if(e)for(f in e)e.hasOwnProperty(f)&&(c[f]=e[f]);return c},isElement:function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===typeof a.ownerDocument}},musthashRender:function(a,b){var c=/\{{([^}]+)\}}/g,d=s.typeOf,e=a,f;if("object"===d(b)&&(c=e.match(c),null!==c))for(var k=d=c.length;k--;)d=c[k],f=c[k].slice(2,c[k].length-2),e=e.replace(d,b[f]);return e},appChooser:function(a){var b=s.typeOf,c=j,d=c._,c=c.Apps;
a="string"===b(a)?a:null;var e=null;!a&&"object"===b(d.defapp)&&(a=d.defapp.name);a&&("object"===b(c)&&"object"===b(c[a]))&&(e=c[a]);return e}},j={_:{},Apps:{},Tools:s,Object:function(a){var b=this,c=s.typeOf,d;d=document.createElement("p");var e={_:{_:$(d)}},f={},k=function(b,d,a){var h;d="string"===c(d)?d:"_";a="boolean"===c(a)?a:!0;if("string"===c(b)){h=b.split(":");1===h.length?(b="_",h=h[0]):(b=h[0],h=h[1]);if("object"!==c(e[b])&&!0===a)e[b]={};else if("object"!==c(e[b]))return;if("object"!==
c(e[b][d])&&!0===a)e[b][d]=$(document.createElement("p"));else if("object"!==c(e[b][d]))return;return{context:d,name:h,hub:e[b],event:e[b][d]}}};this._={};this._.clone=function(){Object.create||function(b){function c(){}c.prototype=b;return new c}};this._.implement=function(c){if(c)for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);return b};d=this._.clone(this);a&&this._.implement.call(d,a);this.on=function(d,a,e){a="function"===typeof a?a:void 0;d=k(d,e);if("object"===c(d)&&"function"===c(a))d.event.on(d.name,
$.proxy(a,b));return b};this.trigger=function(d,a,e){var h="string"===c(e)?e:"all";d=k(d,e,!1);if("object"===c(d))if("all"===h){var h=d.hub,l;for(l in h)h.hasOwnProperty(l)&&h[l].trigger(d.name,a)}else d.event.trigger(d.name,a);return b};this.off=function(d,a){var n="string"===c(a)?a:"all",h=k(d,a,!1),l,g;if(void 0!==h)if(l=d.split(":"),l=1===l.length?null:h.name,"all"===n)for(g in n=h.hub,n)n.hasOwnProperty(g)&&n[g].off(l);else h.event.off(l);else for(g in e)if(e.hasOwnProperty(g))for(l in e[g])e[g].hasOwnProperty(l)&&
e[g][l].off();return b};this.close=function(d){var a="object"===c(d)?d:{};d="boolean"===c(a.clearData)?a.clearData:!0;a="boolean"===c(a.closeData)?a.closeData:!0;b.trigger("Before:Close");if(!0===a){var a=f,e;for(e in a)if("object"===c(a[e]))if("function"===c(a[e].close))a[e].close();else for(var h in a[e])"object"===c(a[e][h])&&"function"===c(a[e][h].close)&&a[e][h].close()}!0===d&&b.data(null);b.off()};this.data=function(d,a){if("undefined"===c(a)&&"string"===c(d))return f[d];if("string"===c(d))f[d]=
a;else if(null===d)f={};else if("undefined"===c(d))return f;return b};return d},Cache:function(a){var b={},c={},d={history:[],size:10,localStorage:!1,id:null},e=function(){var a;if("boolean"===typeof d.localStorage&&("string"===typeof d.id&&!0===d.localStorage&&0<d.id.length)&&"undefined"!==typeof localStorage)try{a=JSON.stringify(d.history),localStorage.setItem(d.id,a),b.trigger("LocalStorage:Save",{id:d.id,data:d.history})}catch(c){}};if("object"===typeof a)for(var f in a)a.hasOwnProperty(f)&&(d[f]=
a[f]);var k;if("boolean"===typeof d.localStorage&&("string"===typeof d.id&&!0===d.localStorage&&0<d.id.length)&&"undefined"!==typeof localStorage)try{k=JSON.parse(localStorage.getItem(d.id)),"object"===typeof k&&void 0!==k.length&&(d.history=k)}catch(p){}c={add:function(a){var c=d.history.length,h=d.size;"undefined"!==typeof a&&("object"==typeof a&&a.length?(d.history=d.history.concat(a),c=d.history.length,c>=h&&d.history.splice(0,c-h)):(c>=h&&d.history.shift(),d.history.push(a)));e();return b},get:function(){return d.history},
remove:function(b){var a=d.history,c=d.history.length,l=!1;if("undefined"!==typeof b)for(;c--;)if(a[c]===b){d.history.splice(c,1);l=!0;break}e();return l},exists:function(b){var a=d.history,c=d.history.length;if("undefined"!==typeof b)for(;c--;)if(a[c]===b)return c;return!1},addUnique:function(a){var c=d.history,h=d.history.length;if("undefined"!==typeof a)for(;h--;)if(c[h]===a){d.history.splice(h,1);break}d.history.push(a);e();return b},setMaxSize:function(a){d.size="number"===typeof a?a:10;return b},
resetCache:function(){d.history=[];e()},removeAtIndex:function(b){if("number"===typeof b)return b<d.history.length?(d.history.splice(b,1),!0):!1;e()},setLocalStorage:function(b){d.localStorage="boolean"===typeof b?b:d.localStorage}};return b=new j.Object(c)},Api:function(a){var b,c={},d=s.typeOf,e=s.merge,f={protocol:"http://",timeout:1E4,async:!0},k={},p={},m=function(a,d,c,e){c.success=function(a){e.trigger("Success",a);b.trigger("Success",a)};c.error=function(a,c){var d={error:{id:2,description:c,
response:a.response,xhr:a}},h="Error";if("timeout"===c||"Timeout"===c)h="Timeout";e.trigger(h,d);b.trigger(h,d)};c.type=a;c.url=c.protocol+p.url+d.endpoint;a=$.ajax(c);e.request=a;return e},n=function(a,c,h){var q=null,r="Unknown";"string"===d(a)&&"object"===d(k[a])?(a="object"===d(k[a].options)?k[a].options:null,q=e(f,a),q=e(q,c)):("string"===d(a)&&(r=a),h.trigger("Error",{error:{id:1,description:"Request '"+r+"' doesn't exist."}}),b.trigger("Error",{error:{id:1,description:"Request '"+r+"' doesn't exist."}}));
return q},h;for(h in a)if("requests"!==h&&"url"!==h)f[h]=a[h];else if("requests"===h){var l=a[h];if("object"===d(l)){var g=void 0;for(g in l)if(l.hasOwnProperty(g)){var q=g,r=l[g];"string"===d(r.endpoint)&&(k[q]=r)}}else"string"===d(l)&&"string"===d(void 0)&&"string"===d((void 0).endpoint)&&(k[l]=void 0)}else"url"===h&&(p[h]=a[h]);c.post=function(a,b){var c=new j.Object,d=n(a,b,c);d&&m("POST",k[a],d,c);return c};c.get=function(a,b){var c=new j.Object,d=n(a,b,c);d&&m("GET",k[a],d,c);return c};return b=
new j.Object(c)},Controller:function(a){var b=s.typeOf;a="object"===b(a)?a:{};var c="string"===b(a.appname)?a.appname:null;c&&"object"===b(j.Apps[c])?a.app=j.Apps[c]:"object"===b(j._)&&"object"===b(j._.defapp)&&(a.app=j._.defapp);a=new j.Object(a);"function"===b(a.init)&&a.init(a);return a},Data:function(a){var b,c=s.typeOf,d=s.merge,e={},f=!1,k={},p=!1,m=!1,n=function(a,r){var g="object"===c(r)?r:{},l="string"===c(g.request)?g.request:"string"===c(e.request)?e.request:null,k="object"===c(e.app.Api)?
e.app.Api:null,f,j,n,m="string"===c(g.method)?g.method:null,p="object"===c(g.data)?g.data:null,s;!m&&"push"===a?(m="post",s="Push",j="boolean"===c(g.update)?g.update:!1,n="boolean"===c(g.merge)?g.merge:!1,f="string"===c(e.pushkey)?e.pushkey:null):!m&&"pull"===a&&(m="get",s="Pull",j="boolean"===c(g.update)?g.update:!0,n="boolean"===c(g.merge)?g.merge:!0,f="string"===c(e.pullkey)?e.pullkey:null);null===p&&(p="object"===c(b.attributes)?b.attributes:{});g.data=p;l&&k&&(g=k[m](l,g),g.on("Success",function(a,
e){p=f&&"undefined"!==c(e[f])?e[f]:e;!0===n&&(p=d(p,b.attributes));!0===j&&(b.set(p),h("Data:Available",p));h(s+":Success",p)}),g.on("Error",function(a,b){h(s+":Error",b)}),g.on("Timeout",function(a,b){h(s+":Timeout",b)}));return b},h=function(a,d){b.trigger(a,d);f&&"function"===c(k[a])&&k[a].bind(b)(d)};a="object"===c(a)?a:{};var l="string"===c(a.appname)?a.appname:null,g="object"===c(this.config)?this.config:{},g=d(g,a),e=d(g,{attributes:{}});l&&"object"===c(j.Apps[l])?e.app=j.Apps[l]:"object"===
c(j._)&&"object"===c(j._.defapp)&&(e.app=j._.defapp);e.id&&e.attributes&&!m&&(m=new j.Cache({size:1,id:e.id,localStorage:!0}),m.get()[0]!=={}||""!==m.get()[0]?e.attributes=m.get()[0]:m.add(e.attributes),p=!0);e.set=function(a,d){if("object"===typeof a)b.attributes=a,h("Change",{newdata:a});else if("string"===typeof a)"object"!==c(b.attributes)&&(b.attributes={}),b.attributes[a]=d,h("Change:"+a,{newdata:d});else return!1;var g="string"===c(e.id)?e.id:null;g&&(m||(m=new j.Cache({size:1,id:g,localStorage:!0})),
m.add(b.attributes));return b};e.get=function(a){var d=b.attributes;return"string"===c(a)&&"object"===c(b.attributes)?d[a]:d};e.pull=function(a){return n("pull",a)};e.push=function(a){return n("push",a)};e.config=g;"object"===c(g.events)&&(f=!0,k=g.events);b=new j.Object(e);"function"===c(b.init)&&b.init(b);!0===p&&("undefined"!==c(b.attributes)&&b.attributes!=={})&&h("Data:Available",b.attributes);return b},Microtemplate:function(a){var b,c=!1,d=s,e=d.typeOf,f=d.isElement,k=d.appChooser,p=d.musthashRender,
m,n=function(a){a="object"===e(a)?a:{};var d="object"===e(a.variables)?a.variables:null,h="object"===e(a.el)&&f(a.el[0])?a.el:null,g=function(a){b.result=p(a,d);b.el=$(b.result);h&&h.html(b.el);b.trigger("Rendered")};if(!0===c)g(b.html);else b.on("Ready",function(){g(b.html)})},h=function(a,d){var h="boolean"===e(d)?d:!1;void 0!==b?(b.config.html=a,b.html=a):l.html=a;c=!0;!0===h&&g(null,!0)},l={config:{version:1,use_app_storage:!0},html:"",render:n,result:"",el:void 0},g=function(a,d){var c="object"===
e(a)?a:null,h,g,f;g=c=void 0!==b?b.config:l.config;"string"===e(c.id)&&(!0===c.use_app_storage?(h=k(c.appname))&&(f=h._.getTemplate(c.id)):(m=new j.Cache({size:1,id:c.id,localStorage:!0}),f=m.get()[0]),void 0===f||!0===d?!0===c.use_app_storage?h._.saveTemplate(c.id,c):m.add(c):f.version!==c.version?(!0===c.use_app_storage?h._.saveTemplate(c.id,c):m.add(c),g=c):g=f);return g};a=e(a)?a:{};var d={},q;for(q in a)a.hasOwnProperty(q)&&(l.config[q]=a[q]);d=g();"string"===e(d.html)?h(d.html):"string"===e(d.url)?
(q=d.url+"?v"+d.version,a={},d=$$._.defapp,d="boolean"===e(d.config.pushState)?d.config.pushState:!1,a.url=q,!0===d&&!q.match(/^[a-zA-Z]+:\/\//)&&(a.url=location.protocol+"//"+$$._.defapp.url+"/"+q),a.success=function(a){h(a,!0);b.trigger("Ready")},a.error=function(a){b.trigger("Error",{error:a})},$.ajax(a)):"object"===e(d.el)&&f(d.el[0])&&h(d.el.html());b=new j.Object(l);!0===c&&b.trigger("Ready");"function"===e(b.init)&&b.init(b);b.on("Render",function(a,c){n(c)});return b},View:function(a){var b=
s,c=b.typeOf,d=b.isElement,b=b.merge,e,f={elements:{}},k={},p=function(a,b){var g=d(a[0])?a:e.template.el,f="object"===c(b)?b:"object"===c(k.elements)?k.elements:null;if(f)for(var j in f)f.hasOwnProperty(j)&&(e.elements[j]=g.find(f[j]))},m=function(a){var b=e.template,g="object"===c(a)?a:{},f="object"===c(g.el)&&d(g.el[0])?g.el:null;b&&(b.off("Rendered","thisview"),b.on("Rendered",function(){f&&(f.html(this.el),p(f));e.update=n;e.trigger("Template:Rendered");"object"===c(k.events)&&"function"===c(k.events["Template:Rendered"])&&
k.events["Template:Rendered"].bind(e)()},"thisview"),b.render(a));return e},n=function(a,b){var g="object"===c(e.elements)?e.elements:null,f="string"===typeof a?a:null,k="string"===typeof b||"number"===typeof b?b:"",j,m;g&&f&&(f=f.split(":"),a=f[0],"string"===typeof f[1]&&(j=f[1]),"undefined"!==typeof g[a]&&d(g[a][0])?m=g[a]:"string"===a&&(m=$(a)),"object"===c(m)&&d(m[0])&&(null===j||void 0===j?m.html(k):m.attr(j,k)));return e};a=c(a)?a:{};k="object"===c(this.config)?this.config:{};k=b(k,a);f.template=
!0===k.extended&&"object"===c(k.template)&&"object"===c(k.template.config)?new $$.Microtemplate(k.template.config):"object"===c(k.template)?k.template:null;f.render=m;f.gatherElements=p;e=new j.Object(f);"function"===c(e.init)&&e.init(e);e.on("Render",function(a,b){m(b)});return e},App:function(a){var b=new j.Object,c=s,d=c.typeOf,e=c.isElement,c={Router:{Default:""}},f,k={},p=!0,m,n=function(a,c,e){var g;c="boolean"===d(c)?c:!1;e="boolean"===d(e)?e:!1;var f=g;g=a.substr(1,a.length-1);!1===c&&(f=
g);p=!1;if(!0===b.config.pushState){if(m!==g){m=g;if(!0===c){if(f=window.location.href.replace(location.protocol+"//"+b.url,""),a=h(f),!0===e||"#"===f.charAt(0)||"/"===f.charAt(1)||"/"===f.charAt(0)&&"#"===f.charAt(1)&&"/"===f.charAt(2))f=f.replace("/#/",""),f=f.replace("#/",""),f=f.replace("#",""),"/"===f.charAt(0)&&(f=f.substr(1)),a=h(f),""===f&&(f="/"),window.history.pushState(a.variables,b.name,f)}else a=h(g),window.history.pushState(a.variables,b.name,f);b.trigger("Router:BeforeRouter");b.trigger("Router:"+
a.key,a.variables)}}else a=h(g),b.trigger("Router:BeforeRouter"),b.trigger("Router:"+a.key,a.variables)},h=function(a){var b=k;a=a.split("/");var c=!1,d={},e,f,g=[];""===a[0]&&a.splice(0,1);""===a[a.length-1]&&(a=a.splice(0,a.length-1));e=a.length;for(var h in b)if(b.hasOwnProperty(h)){if(e===b[h].len){c=!0;f=h;for(var j=0;j<e;j++)a[j].toLowerCase()!==b[h].split[j].toLowerCase()&&(c=!1);if(!1===c)for(j=0;j<e;j++)if(a[j].toLowerCase()===b[h].split[j].toLowerCase()&&void 0===b[h].variables[j]?(g.push(!0),
f=h):void 0!==b[h].variables[j]&&(g.push(!0),d[b[h].variables[j]]=a[j]),g.length===e)return{key:b[f].event,variables:d}}if(!0===c)break}return!0===c?{key:b[f].event,variables:d}:{key:"Default",variables:void 0}},l=function(a){a="string"===d(a)?a:null;var b="";return a?("#"!==a.charAt(0)&&"/"!==a.charAt(0)?b="#/"+a:"/"===a.charAt(0)?b="#"+a:"#"===a.charAt(0)&&"/"!==a.charAt(1)?(b=a.substring(a.length,2),b="#/"+b):b=a,b):null},g="object"===d(a)?a:{};a="string"===d(g.name)?g.name:Math.random().toString(36).substring(7);
var e="object"===d(g.el)&&e(g.el[0])?g.el:$("body"),q="boolean"===typeof g.localStorage?g.localStorage:!0,r="object"===typeof g.versions?g.versions:{},t=a+"_templates",x=a+"_data";r.templates="number"===typeof r.templates?r.templates:1;r.data="number"===typeof r.data?r.data:1;if(g)for(var v in g)g.hasOwnProperty(v)&&(c[v]=g[v]);c.versions=r;f=new j.Cache({size:1,id:t,localStorage:q});new j.Cache({size:1,id:x,localStorage:q});j._.defapp=b;j.Apps[a]=b;v=c.Router;var g={},u,w={},A,B=/\{([^}]+)\}/g;if("object"===
typeof v){for(var y in v)if(v.hasOwnProperty(y)){q=y;t=q.split("/");""===t[0]&&t.splice(0,1);""===t[t.length-1]&&(t=t.splice(t.length-1,1));x=t.length;u=q.match(B);r=[];if(u)for(var z=A=0;z<x;z++)u=t[z].match(B)?t[z]:void 0,void 0!==u?(u=u.substr(1,u.length-2),r.push(u),w[u]=void 0,A++):r.push(void 0);g[y]={event:v[y],route:q,len:x,split:t,variables:r,varkeys:w}}k=g}b.go=function(a){n(l(a))};b.el=e;b.name=a;b.start=function(){b.trigger("Starting");if(!0===b.config.pushState)window.onpopstate=function(){!1===
p&&n(window.location.href,!0,p);p=!1},n(window.location.hash,!0,p);else{if("onhashchange"in window)window.onhashchange=function(){n(window.location.hash)};else{var a=window.location.hash,c;window.setInterval(function(){window.location.hash!=a&&(c=window.location.hash,n(c))},100)}n(window.location.hash)}b.trigger("Started");b.on("a:click",function(a,c){var d=l(c.url),e=c.el;d&&"false"!==e.attr("data-coreroute")&&(!0===b.config.pushState?n(d):window.location=d)});return b};b.config=c;b.url="string"===
d(c.url)?c.url:window.location.host;b.config.pushState="boolean"===d(c.pushState)?c.pushState:window.history.pushState?!0:!1;c.Api&&(b.Api=new j.Api(c.Api));"boolean"!==d(c.routerOverrideLinks)&&(c.routerOverrideLinks=!0);b._={saveTemplate:function(a,b){var c=f.get()[0];"object"!==d(c)&&(c={});c[a]=b;f.add(c)},getTemplate:function(a){var b=f.get()[0];if("object"===d(b))return b[a]}};if(!0===c.routerOverrideLinks)e.on("click",function(a){var c=a.target,d=$(c),e=/(https?:\/\/[^\s]+)/g,f="";if("a"===
c.nodeName||"A"===c.nodeName)f=d.attr("href"),f.match(e)?1===f.match(e).length&&(window.location=f):(a.preventDefault(),b.trigger("a:click",{el:d,url:f}))});"function"===d(b.init)&&b.init(b);$(document).ready(function(){b.trigger("Ready")});return b},version:"0.3.3"};j.View.extend=function(a){var b={};b.config=a;b.config.extended=!0;return j.View.bind(b)};j.Data.extend=function(a){var b={};b.config=a;b.config.extended=!0;return j.Data.bind(b)};j.Controller.extend=function(a){var b={};b.config=a;b.config.extended=
!0;return j.Controller.bind(b)};"function"===typeof define&&define.amd?define("Core",[],function(){return j}):"undefined"!==typeof module&&"undefined"!==typeof exports&&module.exports?module.exports=j:C["string"===typeof w?w:"Core"]=j})(this,"$$");
