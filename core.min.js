/* core.js v0.2.10a by @carlosgavina | hello@carlosgavina.com | https://github.com/carlosgavina/corejs */
(function(y,t){var s={typeOf:function(c){var d=typeof c;"object"===d&&null===c&&(null===c?d="null":"number"===typeof c.length&&(d="array"));return d},merge:function(c,d){var b={},a="object"===s.typeOf(c)?c:null,e="object"===s.typeOf(d)?d:null,g;if(a)for(g in a)a.hasOwnProperty(g)&&(b[g]=a[g]);if(e)for(g in e)e.hasOwnProperty(g)&&(b[g]=e[g]);return b},isElement:function(c){try{return c instanceof HTMLElement}catch(d){return"object"===typeof c&&1===c.nodeType&&"object"===typeof c.style&&"object"===
typeof c.ownerDocument}},musthashRender:function(c,d){var b=/\{{([^}]+)\}}/g,a=s.typeOf,e=c,g;if("object"===a(d)&&(b=e.match(b),null!==b))for(var j=a=b.length;j--;)a=b[j],g=b[j].slice(2,b[j].length-2),e=e.replace(a,d[g]);return e},appChooser:function(c){var d=s.typeOf,b=m,a=b._,b=b.Apps;c="string"===d(c)?c:null;var e=null;!c&&"object"===d(a.defapp)&&(c=a.defapp.name);c&&("object"===d(b)&&"object"===d(b[c]))&&(e=b[c]);return e}},m={_:{},Apps:{},Tools:s,Object:function(c){var d=this,b=s.typeOf,a;a=
document.createElement("p");var e={_:{_:$(a)}},g={},j=function(d,n,a){var f;n="string"===b(n)?n:"_";a="boolean"===b(a)?a:!0;if("string"===b(d)){f=d.split(":");1===f.length?(d="_",f=f[0]):(d=f[0],f=f[1]);if("object"!==b(e[d])&&!0===a)e[d]={};else if("object"!==b(e[d]))return;if("object"!==b(e[d][n])&&!0===a)e[d][n]=$(document.createElement("p"));else if("object"!==b(e[d][n]))return;return{context:n,name:f,hub:e[d],event:e[d][n]}}};this._={};this._.clone=function(){Object.create||function(d){function b(){}
b.prototype=d;return new b}};this._.implement=function(b){if(b)for(var a in b)b.hasOwnProperty(a)&&(d[a]=b[a]);return d};a=this._.clone(this);c&&this._.implement.call(a,c);this.on=function(a,e,c){e="function"===typeof e?e:void 0;a=j(a,c);if("object"===b(a)&&"function"===b(e))a.event.on(a.name,$.proxy(e,d));return d};this.trigger=function(a,e,c){var f="string"===b(c)?c:"all";a=j(a,c,!1);if("object"===b(a))if("all"===f){var f=a.hub,h;for(h in f)f.hasOwnProperty(h)&&f[h].trigger(a.name,e)}else a.event.trigger(a.name,
e);return d};this.off=function(a,c){var p="string"===b(c)?c:"all",f=j(a,c,!1),h,g;if(void 0!==f)if(h=a.split(":"),h=1===h.length?null:f.name,"all"===p)for(g in p=f.hub,p)p.hasOwnProperty(g)&&p[g].off(h);else f.event.off(h);else for(g in e)if(e.hasOwnProperty(g))for(h in e[g])e[g].hasOwnProperty(h)&&e[g][h].off();return d};this.close=function(a){var e="object"===b(a)?a:{};a="boolean"===b(e.clearData)?e.clearData:!0;e="boolean"===b(e.closeData)?e.closeData:!0;d.trigger("Before:Close");if(!0===e){var e=
g,c;for(c in e)if("object"===b(e[c]))if("function"===b(e[c].close))e[c].close();else for(var f in e[c])"object"===b(e[c][f])&&"function"===b(e[c][f].close)&&e[c][f].close()}!0===a&&d.data(null);d.off()};this.data=function(a,e){if("undefined"===b(e)&&"string"===b(a))return g[a];if("string"===b(a))g[a]=e;else if(null===a)g={};else if("undefined"===b(a))return g;return d};return a},Cache:function(c){var d={},b={},a={history:[],size:10,localStorage:!1,id:null},e=function(){var e;if("boolean"===typeof a.localStorage&&
("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&"undefined"!==typeof localStorage)try{e=JSON.stringify(a.history),localStorage.setItem(a.id,e),d.trigger("LocalStorage:Save",{id:a.id,data:a.history})}catch(b){}};if("object"===typeof c)for(var g in c)c.hasOwnProperty(g)&&(a[g]=c[g]);var j;if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&"undefined"!==typeof localStorage)try{j=JSON.parse(localStorage.getItem(a.id)),"object"===typeof j&&
void 0!==j.length&&(a.history=j)}catch(l){}b={add:function(b){var c=a.history.length,f=a.size;"undefined"!==typeof b&&("object"==typeof b&&b.length?(a.history=a.history.concat(b),c=a.history.length,c>=f&&a.history.splice(0,c-f)):(c>=f&&a.history.shift(),a.history.push(b)));e();return d},get:function(){return a.history},remove:function(d){var b=a.history,c=a.history.length,h=!1;if("undefined"!==typeof d)for(;c--;)if(b[c]===d){a.history.splice(c,1);h=!0;break}e();return h},exists:function(d){var b=
a.history,e=a.history.length;if("undefined"!==typeof d)for(;e--;)if(b[e]===d)return e;return!1},addUnique:function(b){var c=a.history,f=a.history.length;if("undefined"!==typeof b)for(;f--;)if(c[f]===b){a.history.splice(f,1);break}a.history.push(b);e();return d},setMaxSize:function(b){a.size="number"===typeof b?b:10;return d},resetCache:function(){a.history=[];e()},removeAtIndex:function(d){if("number"===typeof d)return d<a.history.length?(a.history.splice(d,1),!0):!1;e()},setLocalStorage:function(d){a.localStorage=
"boolean"===typeof d?d:a.localStorage}};return d=new m.Object(b)},Api:function(c){var d,b={},a=s.typeOf,e=s.merge,g={protocol:"http://",timeout:1E4,async:!0},j={},l={},n=function(a,b,e,c){e.success=function(a){c.trigger("Success",a);d.trigger("Success",a)};e.error=function(a,b){var e={error:{id:2,description:b,response:a.response,xhr:a}},f="Error";if("timeout"===b||"Timeout"===b)f="Timeout";c.trigger(f,e);d.trigger(f,e)};e.type=a;e.url=e.protocol+l.url+b.endpoint;a=$.ajax(e);c.request=a;return c},
p=function(b,c,f){var h=null,p="Unknown";"string"===a(b)&&"object"===a(j[b])?(b="object"===a(j[b].options)?j[b].options:null,h=e(g,b),h=e(h,c)):("string"===a(b)&&(p=b),f.trigger("Error",{error:{id:1,description:"Request '"+p+"' doesn't exist."}}),d.trigger("Error",{error:{id:1,description:"Request '"+p+"' doesn't exist."}}));return h},f;for(f in c)if("requests"!==f&&"url"!==f)g[f]=c[f];else if("requests"===f){var h=c[f];if("object"===a(h)){var r=void 0;for(r in h)if(h.hasOwnProperty(r)){var k=r,v=
h[r];"string"===a(v.endpoint)&&(j[k]=v)}}else"string"===a(h)&&"string"===a(void 0)&&"string"===a((void 0).endpoint)&&(j[h]=void 0)}else"url"===f&&(l[f]=c[f]);b.post=function(d,b){var a=new m.Object,e=p(d,b,a);e&&n("POST",j[d],e,a);return a};b.get=function(d,b){var a=new m.Object,e=p(d,b,a);e&&n("GET",j[d],e,a);return a};return d=new m.Object(b)},Controller:function(c){var d=s.typeOf;c="object"===d(c)?c:{};var b="string"===d(c.appname)?c.appname:null;b&&"object"===d(m.Apps[b])?c.app=m.Apps[b]:"object"===
d(m._)&&"object"===d(m._.defapp)&&(c.app=m._.defapp);c=new m.Object(c);"function"===d(c.init)&&c.init(c);return c},Data:function(c){var d,b=s.typeOf,a=s.merge,e={},g=!1,j=!1,l=function(c,f){var h="string"===b(e.request)?e.request:null,g="object"===b(e.app.Api)?e.app.Api:null,k,j,m,q="object"===b(f)?f:{},n="string"===b(q.method)?q.method:null,l="object"===b(q.data)?q.data:null,u;!n&&"push"===c?(n="post",u="Push",j="boolean"===b(q.update)?q.update:!1,m="boolean"===b(q.merge)?q.merge:!1,k="string"===
b(e.pushkey)?e.pushkey:null):!n&&"pull"===c&&(n="get",u="Pull",j="boolean"===b(q.update)?q.update:!0,m="boolean"===b(q.merge)?q.merge:!0,k="string"===b(e.pullkey)?e.pullkey:null);null===l&&(l="object"===b(d.attributes)?d.attributes:{});q.data=l;h&&g&&(h=g[n](h,q),h.on("Success",function(e,c){l=k&&"undefined"!==b(c[k])?c[k]:c;!0===m&&(l=a(l,d.attributes));!0===j&&(d.set(l),d.trigger("Data:Available",l));d.trigger(u+":Success",l)}),h.on("Error",function(b,a){d.trigger(u+":Error",a)}),h.on("Timeout",
function(a,b){d.trigger(u+":Timeout",b)}));return d},n="string"===b(c.appname)?c.appname:null;c="object"===b(c)?c:{};e=a(c,{attributes:{}});n&&"object"===b(m.Apps[n])?e.app=m.Apps[n]:"object"===b(m._)&&"object"===b(m._.defapp)&&(e.app=m._.defapp);e.id&&e.attributes&&!j&&(j=new m.Cache({size:1,id:e.id,localStorage:!0}),j.get()[0]!=={}||""!==j.get()[0]?e.attributes=j.get()[0]:j.add(e.attributes),g=!0);e.set=function(a,c){if("object"===typeof a)d.attributes=a,d.trigger("Change",{newdata:a});else if("string"===
typeof a)"object"!==b(d.attributes)&&(d.attributes={}),d.attributes[a]=c,d.trigger("Change:"+a,{newdata:c});else return!1;var h="string"===b(e.id)?e.id:null;h&&(j||(j=new m.Cache({size:1,id:h,localStorage:!0})),j.add(d.attributes));return d};e.get=function(a){var e=d.attributes;return"string"===b(a)&&"object"===b(d.attributes)?e[a]:e};e.pull=function(a){return l("pull",a)};e.push=function(a){return l("push",a)};d=new m.Object(e);"function"===b(d.init)&&d.init(d);!0===g&&("undefined"!==b(d.attributes)&&
d.attributes!=={})&&d.trigger("Data:Available",d.attributes);return d},Microtemplate:function(c){var d,b=!1,a=s,e=a.typeOf,g=a.isElement,j=a.appChooser,l=a.musthashRender,n,p=function(a){a="object"===e(a)?a:{};var c="object"===e(a.variables)?a.variables:null,f=g(a.el[0])?a.el:null,h=function(a){d.result=l(a,c);d.el=$(d.result);f&&f.html(d.el);d.trigger("Rendered")};if(!0===b)h(d.html);else d.on("Ready",function(){h(d.html)})},f=function(a,c){var f="boolean"===e(c)?c:!1;void 0!==d?(d.config.html=a,
d.html=a):h.html=a;b=!0;!0===f&&r(null,!0)},h={config:{version:1,use_app_storage:!0},html:"",render:p,result:"",el:void 0},r=function(a,b){var c="object"===e(a)?a:null,f,g,k;g=c=void 0!==d?d.config:h.config;"string"===e(c.id)&&(!0===c.use_app_storage?(f=j(c.appname))&&(k=f._.getTemplate(c.id)):(n=new m.Cache({size:1,id:c.id,localStorage:!0}),k=n.get()[0]),void 0===k||!0===b?!0===c.use_app_storage?f._.saveTemplate(c.id,c):n.add(c):k.version!==c.version?(!0===c.use_app_storage?f._.saveTemplate(c.id,
c):n.add(c),g=c):g=k);return g},a=e(c)?c:{};c={};for(var k in a)a.hasOwnProperty(k)&&(h.config[k]=a[k]);c=r();"string"===e(c.html)?f(c.html):"string"===e(c.url)?(k={},k.url=c.url+"?v"+c.version,k.success=function(a){f(a,!0);d.trigger("Ready")},k.error=function(a){d.trigger("Error",{error:a})},$.ajax(k)):"object"===e(c.el)&&g(c.el[0])&&f(c.el.html());d=new m.Object(h);!0===b&&d.trigger("Ready");"function"===e(d.init)&&d.init(d);d.on("Render",function(a,d){p(d)});return d},View:function(c){var d=s,
b=d.typeOf,a=d.isElement,e,d={elements:{}},g={},j=function(d,c){var j=a(d[0])?d:e.template.el,k="object"===b(c)?c:"object"===b(g.elements)?g.elements:null;if(k)for(var l in k)k.hasOwnProperty(l)&&(e.elements[l]=j.find(k[l]))},l=function(d){var c=e.template,g="object"===b(d)?d:{},k="object"===b(g.el)&&a(g.el[0])?g.el:null;c&&(c.off("Rendered","thisview"),c.on("Rendered",function(){k&&(k.html(this.el),j(k));e.update=n;e.trigger("Template:Rendered")},"thisview"),c.render(d));return e},n=function(d,c){var g=
"object"===b(e.elements)?e.elements:null,k="string"===typeof d?d:null,j="string"===typeof c||"number"===typeof c?c:"",l,m;g&&k&&(k=k.split(":"),d=k[0],"string"===typeof k[1]&&(l=k[1]),"undefined"!==typeof g[d]&&a(g[d][0])?m=g[d]:"string"===d&&(m=$(d)),"object"===b(m)&&a(m[0])&&(null===l||void 0===l?m.html(j):m.attr(l,j)));return e};c=b(c)?c:{};for(var p in c)c.hasOwnProperty(p)&&("template"===p||"elements"===p?g[p]=c[p]:d[p]=c[p]);d.template="object"===b(g.template)&&"function"===b(g.template.render)?
g.template:null;d.render=l;d.gatherElements=j;e=new m.Object(d);"function"===b(e.init)&&e.init(e);e.on("Render",function(a,d){l(d)});return e},App:function(c){var d=new m.Object,b=s,a=b.typeOf,e=b.isElement,b={Router:{Default:""}},g,j={},l="object"===a(c)?c:{};c="string"===a(l.name)?l.name:Math.random().toString(36).substring(7);var e="object"===a(l.el)&&e(l.el[0])?l.el:$("body"),n="boolean"===typeof l.localStorage?l.localStorage:!0,p="object"===typeof l.versions?l.versions:{},f=c+"_templates",h=
c+"_data";p.templates="number"===typeof p.templates?p.templates:1;p.data="number"===typeof p.data?p.data:1;if(l)for(var r in l)l.hasOwnProperty(r)&&(b[r]=l[r]);b.versions=p;g=new m.Cache({size:1,id:f,localStorage:n});new m.Cache({size:1,id:h,localStorage:n});m._.defapp=d;m.Apps[c]=d;r=b.Router;var l={},k,v={},t,q=/\{([^}]+)\}/g;if("object"===typeof r){for(var w in r)if(r.hasOwnProperty(w)){n=w;f=n.split("/");""===f[0]&&f.splice(0,1);""===f[f.length-1]&&(f=f.splice(f.length-1,1));h=f.length;k=n.match(q);
p=[];if(k)for(var x=t=0;x<h;x++)k=f[x].match(q)?f[x]:void 0,void 0!==k?(k=k.substr(1,k.length-2),p.push(k),v[k]=void 0,t++):p.push(void 0);l[w]={event:r[w],route:n,len:h,split:f,variables:p,varkeys:v}}j=l}d.el=e;d.name=c;d.start=function(){d.trigger("Starting");var c=function(a){var c=a.substr(1,a.length-1),b;if(""===a)b={key:"Default",variables:{}};else a:{a=j;var c=c.split("/"),e=!1,f={},g;""===c[0]&&c.splice(0,1);""===c[c.length-1]&&(c=c.splice(0,c.length-1));g=c.length;for(b in a)if(a.hasOwnProperty(b)){if(g===
a[b].len){for(var e=!0,h=0;h<g;h++)c[h].toLowerCase()!==a[b].split[h].toLowerCase()&&(e=!1);if(!1===e)for(h=0;h<g&&!(e=c[h].toLowerCase()===a[b].split[h].toLowerCase()&&void 0===a[b].variables[h]?!0:c[h].toLowerCase()!==a[b].split[h].toLowerCase()&&void 0!==a[b].variables[h]?!0:!1,!1===e);h++);}if(!0===e){b={key:a[b].event,variables:f};break a}}b=!1}d.trigger("Router:BeforeRouter");d.trigger("Router:"+b.key,b.variables)};if("onhashchange"in window)window.onhashchange=function(){c(window.location.hash)};
else{var b=window.location.hash,e;window.setInterval(function(){window.location.hash!=b&&(e=window.location.hash,c(e))},100)}c(window.location.hash);d.trigger("Started");d.on("a:click",function(c,d){var b;b=d.url;b="string"===a(b)?b:null;var e="";b?("#"!==b.charAt(0)&&"/"!==b.charAt(0)?e="#/"+b:"/"===b.charAt(0)?e="#"+b:"#"===b.charAt(0)&&"/"!==b.charAt(1)?(e=b.substring(b.length,2),e="#/"+e):e=b,b=e):b=null;e=d.el;b&&"false"!==e.attr("data-coreroute")&&(window.location=b)});return d};d.config=b;
b.Api&&(d.Api=new m.Api(b.Api));"boolean"!==a(b.routerOverrideLinks)&&(b.routerOverrideLinks=!0);d._={saveTemplate:function(b,c){var d=g.get()[0];"object"!==a(d)&&(d={});d[b]=c;g.add(d)},getTemplate:function(b){var c=g.get()[0];if("object"===a(c))return c[b]}};if(!0===b.routerOverrideLinks)e.on("click",function(a){var b=a.target,c=$(b),e=/(https?:\/\/[^\s]+)/g,f="";if("a"===b.nodeName||"A"===b.nodeName)f=c.attr("href"),f.match(e)?1===f.match(e).length&&(window.location=f):(a.preventDefault(),d.trigger("a:click",
{el:c,url:f}))});"function"===a(d.init)&&d.init(d);$(document).ready(function(){d.trigger("Ready")});return d},version:"0.2.10a"};"function"===typeof define&&define.amd?define("Core",[],function(){return m}):"undefined"!==typeof module&&"undefined"!==typeof exports&&module.exports?module.exports=m:y["string"===typeof t?t:"Core"]=m})(this,"$$");
