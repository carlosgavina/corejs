/* core.js v0.3.1b by @carlosgavina | hello@carlosgavina.com | https://github.com/carlosgavina/corejs */
(function(z,t){Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}};var r={typeOf:function(a){var b=typeof a;"object"===b&&null===a&&(null===a?b="null":"number"===typeof a.length&&(b="array"));return b},clone:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor(),c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},merge:function(a,b){var c={},d="object"===r.typeOf(a)?a:null,e="object"===r.typeOf(b)?b:null,j;if(d)for(j in d)d.hasOwnProperty(j)&&
(c[j]=d[j]);if(e)for(j in e)e.hasOwnProperty(j)&&(c[j]=e[j]);return c},isElement:function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===typeof a.ownerDocument}},musthashRender:function(a,b){var c=/\{{([^}]+)\}}/g,d=r.typeOf,e=a,j;if("object"===d(b)&&(c=e.match(c),null!==c))for(var g=d=c.length;g--;)d=c[g],j=c[g].slice(2,c[g].length-2),e=e.replace(d,b[j]);return e},appChooser:function(a){var b=r.typeOf,c=h,d=c._,c=c.Apps;
a="string"===b(a)?a:null;var e=null;!a&&"object"===b(d.defapp)&&(a=d.defapp.name);a&&("object"===b(c)&&"object"===b(c[a]))&&(e=c[a]);return e}},h={_:{},Apps:{},Tools:r,Object:function(a){var b=this,c=r.typeOf,d;d=document.createElement("p");var e={_:{_:$(d)}},j={},g=function(b,k,a){var d;k="string"===c(k)?k:"_";a="boolean"===c(a)?a:!0;if("string"===c(b)){d=b.split(":");1===d.length?(b="_",d=d[0]):(b=d[0],d=d[1]);if("object"!==c(e[b])&&!0===a)e[b]={};else if("object"!==c(e[b]))return;if("object"!==
c(e[b][k])&&!0===a)e[b][k]=$(document.createElement("p"));else if("object"!==c(e[b][k]))return;return{context:k,name:d,hub:e[b],event:e[b][k]}}};this._={};this._.clone=function(){Object.create||function(b){function c(){}c.prototype=b;return new c}};this._.implement=function(c){if(c)for(var a in c)c.hasOwnProperty(a)&&(b[a]=c[a]);return b};d=this._.clone(this);a&&this._.implement.call(d,a);this.on=function(a,d,e){d="function"===typeof d?d:void 0;a=g(a,e);if("object"===c(a)&&"function"===c(d))a.event.on(a.name,
$.proxy(d,b));return b};this.trigger=function(a,d,e){var f="string"===c(e)?e:"all";a=g(a,e,!1);if("object"===c(a))if("all"===f){var f=a.hub,l;for(l in f)f.hasOwnProperty(l)&&f[l].trigger(a.name,d)}else a.event.trigger(a.name,d);return b};this.off=function(a,d){var n="string"===c(d)?d:"all",f=g(a,d,!1),l,m;if(void 0!==f)if(l=a.split(":"),l=1===l.length?null:f.name,"all"===n)for(m in n=f.hub,n)n.hasOwnProperty(m)&&n[m].off(l);else f.event.off(l);else for(m in e)if(e.hasOwnProperty(m))for(l in e[m])e[m].hasOwnProperty(l)&&
e[m][l].off();return b};this.close=function(a){var d="object"===c(a)?a:{};a="boolean"===c(d.clearData)?d.clearData:!0;d="boolean"===c(d.closeData)?d.closeData:!0;b.trigger("Before:Close");if(!0===d){var d=j,e;for(e in d)if("object"===c(d[e]))if("function"===c(d[e].close))d[e].close();else for(var f in d[e])"object"===c(d[e][f])&&"function"===c(d[e][f].close)&&d[e][f].close()}!0===a&&b.data(null);b.off()};this.data=function(d,a){if("undefined"===c(a)&&"string"===c(d))return j[d];if("string"===c(d))j[d]=
a;else if(null===d)j={};else if("undefined"===c(d))return j;return b};return d},Cache:function(a){var b={},c={},d={history:[],size:10,localStorage:!1,id:null},e=function(){var a;if("boolean"===typeof d.localStorage&&("string"===typeof d.id&&!0===d.localStorage&&0<d.id.length)&&"undefined"!==typeof localStorage)try{a=JSON.stringify(d.history),localStorage.setItem(d.id,a),b.trigger("LocalStorage:Save",{id:d.id,data:d.history})}catch(c){}};if("object"===typeof a)for(var j in a)a.hasOwnProperty(j)&&(d[j]=
a[j]);var g;if("boolean"===typeof d.localStorage&&("string"===typeof d.id&&!0===d.localStorage&&0<d.id.length)&&"undefined"!==typeof localStorage)try{g=JSON.parse(localStorage.getItem(d.id)),"object"===typeof g&&void 0!==g.length&&(d.history=g)}catch(p){}c={add:function(a){var c=d.history.length,f=d.size;"undefined"!==typeof a&&("object"==typeof a&&a.length?(d.history=d.history.concat(a),c=d.history.length,c>=f&&d.history.splice(0,c-f)):(c>=f&&d.history.shift(),d.history.push(a)));e();return b},get:function(){return d.history},
remove:function(b){var a=d.history,c=d.history.length,l=!1;if("undefined"!==typeof b)for(;c--;)if(a[c]===b){d.history.splice(c,1);l=!0;break}e();return l},exists:function(b){var a=d.history,c=d.history.length;if("undefined"!==typeof b)for(;c--;)if(a[c]===b)return c;return!1},addUnique:function(a){var c=d.history,f=d.history.length;if("undefined"!==typeof a)for(;f--;)if(c[f]===a){d.history.splice(f,1);break}d.history.push(a);e();return b},setMaxSize:function(a){d.size="number"===typeof a?a:10;return b},
resetCache:function(){d.history=[];e()},removeAtIndex:function(b){if("number"===typeof b)return b<d.history.length?(d.history.splice(b,1),!0):!1;e()},setLocalStorage:function(b){d.localStorage="boolean"===typeof b?b:d.localStorage}};return b=new h.Object(c)},Api:function(a){var b,c={},d=r.typeOf,e=r.merge,j={protocol:"http://",timeout:1E4,async:!0},g={},p={},k=function(a,c,d,e){d.success=function(a){e.trigger("Success",a);b.trigger("Success",a)};d.error=function(a,d){var c={error:{id:2,description:d,
response:a.response,xhr:a}},f="Error";if("timeout"===d||"Timeout"===d)f="Timeout";e.trigger(f,c);b.trigger(f,c)};d.type=a;d.url=d.protocol+p.url+c.endpoint;a=$.ajax(d);e.request=a;return e},n=function(a,c,f){var q=null,l="Unknown";"string"===d(a)&&"object"===d(g[a])?(a="object"===d(g[a].options)?g[a].options:null,q=e(j,a),q=e(q,c)):("string"===d(a)&&(l=a),f.trigger("Error",{error:{id:1,description:"Request '"+l+"' doesn't exist."}}),b.trigger("Error",{error:{id:1,description:"Request '"+l+"' doesn't exist."}}));
return q},f;for(f in a)if("requests"!==f&&"url"!==f)j[f]=a[f];else if("requests"===f){var l=a[f];if("object"===d(l)){var m=void 0;for(m in l)if(l.hasOwnProperty(m)){var q=m,u=l[m];"string"===d(u.endpoint)&&(g[q]=u)}}else"string"===d(l)&&"string"===d(void 0)&&"string"===d((void 0).endpoint)&&(g[l]=void 0)}else"url"===f&&(p[f]=a[f]);c.post=function(a,b){var d=new h.Object,c=n(a,b,d);c&&k("POST",g[a],c,d);return d};c.get=function(a,b){var d=new h.Object,c=n(a,b,d);c&&k("GET",g[a],c,d);return d};return b=
new h.Object(c)},Controller:function(a){var b=r.typeOf;a="object"===b(a)?a:{};var c="string"===b(a.appname)?a.appname:null;c&&"object"===b(h.Apps[c])?a.app=h.Apps[c]:"object"===b(h._)&&"object"===b(h._.defapp)&&(a.app=h._.defapp);a=new h.Object(a);"function"===b(a.init)&&a.init(a);return a},Data:function(a){var b,c=r.typeOf,d=r.merge,e={},j=!1,g={},p=!1,k=!1,n=function(a,l){var g="object"===c(l)?l:{},m="string"===c(g.request)?g.request:"string"===c(e.request)?e.request:null,j="object"===c(e.app.Api)?
e.app.Api:null,h,k,p,n="string"===c(g.method)?g.method:null,s="object"===c(g.data)?g.data:null,v;!n&&"push"===a?(n="post",v="Push",k="boolean"===c(g.update)?g.update:!1,p="boolean"===c(g.merge)?g.merge:!1,h="string"===c(e.pushkey)?e.pushkey:null):!n&&"pull"===a&&(n="get",v="Pull",k="boolean"===c(g.update)?g.update:!0,p="boolean"===c(g.merge)?g.merge:!0,h="string"===c(e.pullkey)?e.pullkey:null);null===s&&(s="object"===c(b.attributes)?b.attributes:{});g.data=s;m&&j&&(g=j[n](m,g),g.on("Success",function(a,
e){s=h&&"undefined"!==c(e[h])?e[h]:e;!0===p&&(s=d(s,b.attributes));!0===k&&(b.set(s),f("Data:Available",s));f(v+":Success",s)}),g.on("Error",function(a,b){f(v+":Error",b)}),g.on("Timeout",function(a,b){f(v+":Timeout",b)}));return b},f=function(a,d){b.trigger(a,d);j&&"function"===c(g[a])&&g[a].bind(b)(d)};a="object"===c(a)?a:{};var l="string"===c(a.appname)?a.appname:null,m="object"===c(this.config)?this.config:{},m=d(m,a),e=d(m,{attributes:{}});l&&"object"===c(h.Apps[l])?e.app=h.Apps[l]:"object"===
c(h._)&&"object"===c(h._.defapp)&&(e.app=h._.defapp);e.id&&e.attributes&&!k&&(k=new h.Cache({size:1,id:e.id,localStorage:!0}),k.get()[0]!=={}||""!==k.get()[0]?e.attributes=k.get()[0]:k.add(e.attributes),p=!0);e.set=function(a,d){if("object"===typeof a)b.attributes=a,f("Change",{newdata:a});else if("string"===typeof a)"object"!==c(b.attributes)&&(b.attributes={}),b.attributes[a]=d,f("Change:"+a,{newdata:d});else return!1;var g="string"===c(e.id)?e.id:null;g&&(k||(k=new h.Cache({size:1,id:g,localStorage:!0})),
k.add(b.attributes));return b};e.get=function(a){var d=b.attributes;return"string"===c(a)&&"object"===c(b.attributes)?d[a]:d};e.pull=function(a){return n("pull",a)};e.push=function(a){return n("push",a)};e.config=m;"object"===c(m.events)&&(j=!0,g=m.events);b=new h.Object(e);"function"===c(b.init)&&b.init(b);!0===p&&("undefined"!==c(b.attributes)&&b.attributes!=={})&&f("Data:Available",b.attributes);return b},Microtemplate:function(a){var b,c=!1,d=r,e=d.typeOf,j=d.isElement,g=d.appChooser,p=d.musthashRender,
k,n=function(a){a="object"===e(a)?a:{};var d="object"===e(a.variables)?a.variables:null,f="object"===e(a.el)&&j(a.el[0])?a.el:null,g=function(a){b.result=p(a,d);b.el=$(b.result);f&&f.html(b.el);b.trigger("Rendered")};if(!0===c)g(b.html);else b.on("Ready",function(){g(b.html)})},f=function(a,d){var f="boolean"===e(d)?d:!1;void 0!==b?(b.config.html=a,b.html=a):l.html=a;c=!0;!0===f&&m(null,!0)},l={config:{version:1,use_app_storage:!0},html:"",render:n,result:"",el:void 0},m=function(a,d){var c="object"===
e(a)?a:null,f,m,j;m=c=void 0!==b?b.config:l.config;"string"===e(c.id)&&(!0===c.use_app_storage?(f=g(c.appname))&&(j=f._.getTemplate(c.id)):(k=new h.Cache({size:1,id:c.id,localStorage:!0}),j=k.get()[0]),void 0===j||!0===d?!0===c.use_app_storage?f._.saveTemplate(c.id,c):k.add(c):j.version!==c.version?(!0===c.use_app_storage?f._.saveTemplate(c.id,c):k.add(c),m=c):m=j);return m},d=e(a)?a:{};a={};for(var q in d)d.hasOwnProperty(q)&&(l.config[q]=d[q]);a=m();"string"===e(a.html)?f(a.html):"string"===e(a.url)?
(q={},q.url=a.url+"?v"+a.version,q.success=function(a){f(a,!0);b.trigger("Ready")},q.error=function(a){b.trigger("Error",{error:a})},$.ajax(q)):"object"===e(a.el)&&j(a.el[0])&&f(a.el.html());b=new h.Object(l);!0===c&&b.trigger("Ready");"function"===e(b.init)&&b.init(b);b.on("Render",function(a,d){n(d)});return b},View:function(a){var b=r,c=b.typeOf,d=b.isElement,b=b.merge,e,j={elements:{}},g={},p=function(a,b){var m=d(a[0])?a:e.template.el,j="object"===c(b)?b:"object"===c(g.elements)?g.elements:null;
if(j)for(var h in j)j.hasOwnProperty(h)&&(e.elements[h]=m.find(j[h]))},k=function(a){var b=e.template,j="object"===c(a)?a:{},h="object"===c(j.el)&&d(j.el[0])?j.el:null;b&&(b.off("Rendered","thisview"),b.on("Rendered",function(){h&&(h.html(this.el),p(h));e.update=n;e.trigger("Template:Rendered");"object"===c(g.events)&&"function"===c(g.events["Template:Rendered"])&&g.events["Template:Rendered"].bind(e)()},"thisview"),b.render(a));return e},n=function(a,b){var g="object"===c(e.elements)?e.elements:
null,j="string"===typeof a?a:null,h="string"===typeof b||"number"===typeof b?b:"",k,n;g&&j&&(j=j.split(":"),a=j[0],"string"===typeof j[1]&&(k=j[1]),"undefined"!==typeof g[a]&&d(g[a][0])?n=g[a]:"string"===a&&(n=$(a)),"object"===c(n)&&d(n[0])&&(null===k||void 0===k?n.html(h):n.attr(k,h)));return e};a=c(a)?a:{};g="object"===c(this.config)?this.config:{};g=b(g,a);j.template=!0===g.extended&&"object"===c(g.template)&&"object"===c(g.template.config)?new $$.Microtemplate(g.template.config):"object"===c(g.template)?
g.template:null;j.render=k;j.gatherElements=p;e=new h.Object(j);"function"===c(e.init)&&e.init(e);e.on("Render",function(a,b){k(b)});return e},App:function(a){var b=new h.Object,c=r,d=c.typeOf,e=c.isElement,c={Router:{Default:""}},j,g={},p="object"===d(a)?a:{};a="string"===d(p.name)?p.name:Math.random().toString(36).substring(7);var e="object"===d(p.el)&&e(p.el[0])?p.el:$("body"),k="boolean"===typeof p.localStorage?p.localStorage:!0,n="object"===typeof p.versions?p.versions:{},f=a+"_templates",l=
a+"_data";n.templates="number"===typeof n.templates?n.templates:1;n.data="number"===typeof n.data?n.data:1;if(p)for(var m in p)p.hasOwnProperty(m)&&(c[m]=p[m]);c.versions=n;j=new h.Cache({size:1,id:f,localStorage:k});new h.Cache({size:1,id:l,localStorage:k});h._.defapp=b;h.Apps[a]=b;m=c.Router;var p={},q,u={},t,y=/\{([^}]+)\}/g;if("object"===typeof m){for(var w in m)if(m.hasOwnProperty(w)){k=w;f=k.split("/");""===f[0]&&f.splice(0,1);""===f[f.length-1]&&(f=f.splice(f.length-1,1));l=f.length;q=k.match(y);
n=[];if(q)for(var x=t=0;x<l;x++)q=f[x].match(y)?f[x]:void 0,void 0!==q?(q=q.substr(1,q.length-2),n.push(q),u[q]=void 0,t++):n.push(void 0);p[w]={event:m[w],route:k,len:l,split:f,variables:n,varkeys:u}}g=p}b.el=e;b.name=a;b.start=function(){b.trigger("Starting");var a=function(a){var d=a.substr(1,a.length-1),c;if(""===a)c={key:"Default",variables:{}};else a:{a=g;var d=d.split("/"),e=!1,f={},j;""===d[0]&&d.splice(0,1);""===d[d.length-1]&&(d=d.splice(0,d.length-1));j=d.length;for(c in a)if(a.hasOwnProperty(c)){if(j===
a[c].len){for(var e=!0,h=0;h<j;h++)d[h].toLowerCase()!==a[c].split[h].toLowerCase()&&(e=!1);if(!1===e)for(h=0;h<j&&!(d[h].toLowerCase()===a[c].split[h].toLowerCase()&&void 0===a[c].variables[h]?(e=!0,f[a[c].variables[h]]=d[h]):d[h].toLowerCase()!==a[c].split[h].toLowerCase()&&void 0!==a[c].variables[h]?(e=!0,f[a[c].variables[h]]=d[h]):e=!1,!1===e);h++);}c=!0===e?{key:a[c].event,variables:f}:{key:"Default",variables:void 0};break a}c=!1}b.trigger("Router:BeforeRouter");b.trigger("Router:"+c.key,c.variables)};
if("onhashchange"in window)window.onhashchange=function(){a(window.location.hash)};else{var c=window.location.hash,e;window.setInterval(function(){window.location.hash!=c&&(e=window.location.hash,a(e))},100)}a(window.location.hash);b.trigger("Started");b.on("a:click",function(a,c){var b;b=c.url;b="string"===d(b)?b:null;var e="";b?("#"!==b.charAt(0)&&"/"!==b.charAt(0)?e="#/"+b:"/"===b.charAt(0)?e="#"+b:"#"===b.charAt(0)&&"/"!==b.charAt(1)?(e=b.substring(b.length,2),e="#/"+e):e=b,b=e):b=null;e=c.el;
b&&"false"!==e.attr("data-coreroute")&&(window.location=b)});return b};b.config=c;c.Api&&(b.Api=new h.Api(c.Api));"boolean"!==d(c.routerOverrideLinks)&&(c.routerOverrideLinks=!0);b._={saveTemplate:function(a,b){var c=j.get()[0];"object"!==d(c)&&(c={});c[a]=b;j.add(c)},getTemplate:function(a){var b=j.get()[0];if("object"===d(b))return b[a]}};if(!0===c.routerOverrideLinks)e.on("click",function(a){var c=a.target,d=$(c),e=/(https?:\/\/[^\s]+)/g,f="";if("a"===c.nodeName||"A"===c.nodeName)f=d.attr("href"),
f.match(e)?1===f.match(e).length&&(window.location=f):(a.preventDefault(),b.trigger("a:click",{el:d,url:f}))});"function"===d(b.init)&&b.init(b);$(document).ready(function(){b.trigger("Ready")});return b},version:"0.3.1b"};h.View.extend=function(a){var b={};b.config=a;b.config.extended=!0;return h.View.bind(b)};h.Data.extend=function(a){var b={};b.config=a;b.config.extended=!0;return h.Data.bind(b)};h.Controller.extend=function(a){var b={};b.config=a;b.config.extended=!0;return h.Controller.bind(b)};
"function"===typeof define&&define.amd?define("Core",[],function(){return h}):"undefined"!==typeof module&&"undefined"!==typeof exports&&module.exports?module.exports=h:z["string"===typeof t?t:"Core"]=h})(this,"$$");
