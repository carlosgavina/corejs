/* core.js v0.3 by @carlosgavina | hello@carlosgavina.com | https://github.com/carlosgavina/corejs */
(function(z,t){Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}};var r={typeOf:function(a){var b=typeof a;"object"===b&&null===a&&(null===a?b="null":"number"===typeof a.length&&(b="array"));return b},clone:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor(),c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},merge:function(a,b){var c={},d="object"===r.typeOf(a)?a:null,e="object"===r.typeOf(b)?b:null,h;if(d)for(h in d)d.hasOwnProperty(h)&&
(c[h]=d[h]);if(e)for(h in e)e.hasOwnProperty(h)&&(c[h]=e[h]);return c},isElement:function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===typeof a.ownerDocument}},musthashRender:function(a,b){var c=/\{{([^}]+)\}}/g,d=r.typeOf,e=a,h;if("object"===d(b)&&(c=e.match(c),null!==c))for(var f=d=c.length;f--;)d=c[f],h=c[f].slice(2,c[f].length-2),e=e.replace(d,b[h]);return e},appChooser:function(a){var b=r.typeOf,c=j,d=c._,c=c.Apps;
a="string"===b(a)?a:null;var e=null;!a&&"object"===b(d.defapp)&&(a=d.defapp.name);a&&("object"===b(c)&&"object"===b(c[a]))&&(e=c[a]);return e}},j={_:{},Apps:{},Tools:r,Object:function(a){var b=this,c=r.typeOf,d;d=document.createElement("p");var e={_:{_:$(d)}},h={},f=function(b,k,a){var d;k="string"===c(k)?k:"_";a="boolean"===c(a)?a:!0;if("string"===c(b)){d=b.split(":");1===d.length?(b="_",d=d[0]):(b=d[0],d=d[1]);if("object"!==c(e[b])&&!0===a)e[b]={};else if("object"!==c(e[b]))return;if("object"!==
c(e[b][k])&&!0===a)e[b][k]=$(document.createElement("p"));else if("object"!==c(e[b][k]))return;return{context:k,name:d,hub:e[b],event:e[b][k]}}};this._={};this._.clone=function(){Object.create||function(b){function c(){}c.prototype=b;return new c}};this._.implement=function(c){if(c)for(var a in c)c.hasOwnProperty(a)&&(b[a]=c[a]);return b};d=this._.clone(this);a&&this._.implement.call(d,a);this.on=function(a,d,e){d="function"===typeof d?d:void 0;a=f(a,e);if("object"===c(a)&&"function"===c(d))a.event.on(a.name,
$.proxy(d,b));return b};this.trigger=function(a,d,e){var g="string"===c(e)?e:"all";a=f(a,e,!1);if("object"===c(a))if("all"===g){var g=a.hub,l;for(l in g)g.hasOwnProperty(l)&&g[l].trigger(a.name,d)}else a.event.trigger(a.name,d);return b};this.off=function(a,d){var n="string"===c(d)?d:"all",g=f(a,d,!1),l,m;if(void 0!==g)if(l=a.split(":"),l=1===l.length?null:g.name,"all"===n)for(m in n=g.hub,n)n.hasOwnProperty(m)&&n[m].off(l);else g.event.off(l);else for(m in e)if(e.hasOwnProperty(m))for(l in e[m])e[m].hasOwnProperty(l)&&
e[m][l].off();return b};this.close=function(a){var d="object"===c(a)?a:{};a="boolean"===c(d.clearData)?d.clearData:!0;d="boolean"===c(d.closeData)?d.closeData:!0;b.trigger("Before:Close");if(!0===d){var d=h,e;for(e in d)if("object"===c(d[e]))if("function"===c(d[e].close))d[e].close();else for(var g in d[e])"object"===c(d[e][g])&&"function"===c(d[e][g].close)&&d[e][g].close()}!0===a&&b.data(null);b.off()};this.data=function(d,a){if("undefined"===c(a)&&"string"===c(d))return h[d];if("string"===c(d))h[d]=
a;else if(null===d)h={};else if("undefined"===c(d))return h;return b};return d},Cache:function(a){var b={},c={},d={history:[],size:10,localStorage:!1,id:null},e=function(){var a;if("boolean"===typeof d.localStorage&&("string"===typeof d.id&&!0===d.localStorage&&0<d.id.length)&&"undefined"!==typeof localStorage)try{a=JSON.stringify(d.history),localStorage.setItem(d.id,a),b.trigger("LocalStorage:Save",{id:d.id,data:d.history})}catch(c){}};if("object"===typeof a)for(var h in a)a.hasOwnProperty(h)&&(d[h]=
a[h]);var f;if("boolean"===typeof d.localStorage&&("string"===typeof d.id&&!0===d.localStorage&&0<d.id.length)&&"undefined"!==typeof localStorage)try{f=JSON.parse(localStorage.getItem(d.id)),"object"===typeof f&&void 0!==f.length&&(d.history=f)}catch(p){}c={add:function(a){var c=d.history.length,g=d.size;"undefined"!==typeof a&&("object"==typeof a&&a.length?(d.history=d.history.concat(a),c=d.history.length,c>=g&&d.history.splice(0,c-g)):(c>=g&&d.history.shift(),d.history.push(a)));e();return b},get:function(){return d.history},
remove:function(b){var a=d.history,c=d.history.length,l=!1;if("undefined"!==typeof b)for(;c--;)if(a[c]===b){d.history.splice(c,1);l=!0;break}e();return l},exists:function(b){var a=d.history,c=d.history.length;if("undefined"!==typeof b)for(;c--;)if(a[c]===b)return c;return!1},addUnique:function(a){var c=d.history,g=d.history.length;if("undefined"!==typeof a)for(;g--;)if(c[g]===a){d.history.splice(g,1);break}d.history.push(a);e();return b},setMaxSize:function(a){d.size="number"===typeof a?a:10;return b},
resetCache:function(){d.history=[];e()},removeAtIndex:function(b){if("number"===typeof b)return b<d.history.length?(d.history.splice(b,1),!0):!1;e()},setLocalStorage:function(b){d.localStorage="boolean"===typeof b?b:d.localStorage}};return b=new j.Object(c)},Api:function(a){var b,c={},d=r.typeOf,e=r.merge,h={protocol:"http://",timeout:1E4,async:!0},f={},p={},k=function(a,c,d,e){d.success=function(a){e.trigger("Success",a);b.trigger("Success",a)};d.error=function(a,d){var c={error:{id:2,description:d,
response:a.response,xhr:a}},g="Error";if("timeout"===d||"Timeout"===d)g="Timeout";e.trigger(g,c);b.trigger(g,c)};d.type=a;d.url=d.protocol+p.url+c.endpoint;a=$.ajax(d);e.request=a;return e},n=function(a,c,g){var q=null,l="Unknown";"string"===d(a)&&"object"===d(f[a])?(a="object"===d(f[a].options)?f[a].options:null,q=e(h,a),q=e(q,c)):("string"===d(a)&&(l=a),g.trigger("Error",{error:{id:1,description:"Request '"+l+"' doesn't exist."}}),b.trigger("Error",{error:{id:1,description:"Request '"+l+"' doesn't exist."}}));
return q},g;for(g in a)if("requests"!==g&&"url"!==g)h[g]=a[g];else if("requests"===g){var l=a[g];if("object"===d(l)){var m=void 0;for(m in l)if(l.hasOwnProperty(m)){var q=m,u=l[m];"string"===d(u.endpoint)&&(f[q]=u)}}else"string"===d(l)&&"string"===d(void 0)&&"string"===d((void 0).endpoint)&&(f[l]=void 0)}else"url"===g&&(p[g]=a[g]);c.post=function(a,b){var d=new j.Object,c=n(a,b,d);c&&k("POST",f[a],c,d);return d};c.get=function(a,b){var d=new j.Object,c=n(a,b,d);c&&k("GET",f[a],c,d);return d};return b=
new j.Object(c)},Controller:function(a){var b=r.typeOf;a="object"===b(a)?a:{};var c="string"===b(a.appname)?a.appname:null;c&&"object"===b(j.Apps[c])?a.app=j.Apps[c]:"object"===b(j._)&&"object"===b(j._.defapp)&&(a.app=j._.defapp);a=new j.Object(a);"function"===b(a.init)&&a.init(a);return a},Data:function(a){var b,c=r.typeOf,d=r.merge,e={},h=!1,f={},p=!1,k=!1,n=function(a,l){var f="object"===c(l)?l:{},m="string"===c(f.request)?f.request:"string"===c(e.request)?e.request:null,h="object"===c(e.app.Api)?
e.app.Api:null,j,k,p,n="string"===c(f.method)?f.method:null,s="object"===c(f.data)?f.data:null,v;!n&&"push"===a?(n="post",v="Push",k="boolean"===c(f.update)?f.update:!1,p="boolean"===c(f.merge)?f.merge:!1,j="string"===c(e.pushkey)?e.pushkey:null):!n&&"pull"===a&&(n="get",v="Pull",k="boolean"===c(f.update)?f.update:!0,p="boolean"===c(f.merge)?f.merge:!0,j="string"===c(e.pullkey)?e.pullkey:null);null===s&&(s="object"===c(b.attributes)?b.attributes:{});f.data=s;m&&h&&(f=h[n](m,f),f.on("Success",function(a,
e){s=j&&"undefined"!==c(e[j])?e[j]:e;!0===p&&(s=d(s,b.attributes));!0===k&&(b.set(s),g("Data:Available",s));g(v+":Success",s)}),f.on("Error",function(a,b){g(v+":Error",b)}),f.on("Timeout",function(a,b){g(v+":Timeout",b)}));return b},g=function(a,d){b.trigger(a,d);h&&"function"===c(f[a])&&f[a].bind(b)(d)};a="object"===c(a)?a:{};var l="string"===c(a.appname)?a.appname:null,m="object"===c(this.config)?this.config:{},m=d(m,a),e=d(m,{attributes:{}});l&&"object"===c(j.Apps[l])?e.app=j.Apps[l]:"object"===
c(j._)&&"object"===c(j._.defapp)&&(e.app=j._.defapp);e.id&&e.attributes&&!k&&(k=new j.Cache({size:1,id:e.id,localStorage:!0}),k.get()[0]!=={}||""!==k.get()[0]?e.attributes=k.get()[0]:k.add(e.attributes),p=!0);e.set=function(a,d){if("object"===typeof a)b.attributes=a,g("Change",{newdata:a});else if("string"===typeof a)"object"!==c(b.attributes)&&(b.attributes={}),b.attributes[a]=d,g("Change:"+a,{newdata:d});else return!1;var f="string"===c(e.id)?e.id:null;f&&(k||(k=new j.Cache({size:1,id:f,localStorage:!0})),
k.add(b.attributes));return b};e.get=function(a){var d=b.attributes;return"string"===c(a)&&"object"===c(b.attributes)?d[a]:d};e.pull=function(a){return n("pull",a)};e.push=function(a){return n("push",a)};e.config=m;"object"===c(m.events)&&(h=!0,f=m.events);b=new j.Object(e);"function"===c(b.init)&&b.init(b);!0===p&&("undefined"!==c(b.attributes)&&b.attributes!=={})&&g("Data:Available",b.attributes);return b},Microtemplate:function(a){var b,c=!1,d=r,e=d.typeOf,h=d.isElement,f=d.appChooser,p=d.musthashRender,
k,n=function(a){a="object"===e(a)?a:{};var d="object"===e(a.variables)?a.variables:null,g="object"===e(a.el)&&h(a.el[0])?a.el:null,f=function(a){b.result=p(a,d);b.el=$(b.result);g&&g.html(b.el);b.trigger("Rendered")};if(!0===c)f(b.html);else b.on("Ready",function(){f(b.html)})},g=function(a,d){var g="boolean"===e(d)?d:!1;void 0!==b?(b.config.html=a,b.html=a):l.html=a;c=!0;!0===g&&m(null,!0)},l={config:{version:1,use_app_storage:!0},html:"",render:n,result:"",el:void 0},m=function(a,d){var c="object"===
e(a)?a:null,g,m,h;m=c=void 0!==b?b.config:l.config;"string"===e(c.id)&&(!0===c.use_app_storage?(g=f(c.appname))&&(h=g._.getTemplate(c.id)):(k=new j.Cache({size:1,id:c.id,localStorage:!0}),h=k.get()[0]),void 0===h||!0===d?!0===c.use_app_storage?g._.saveTemplate(c.id,c):k.add(c):h.version!==c.version?(!0===c.use_app_storage?g._.saveTemplate(c.id,c):k.add(c),m=c):m=h);return m},d=e(a)?a:{};a={};for(var q in d)d.hasOwnProperty(q)&&(l.config[q]=d[q]);a=m();"string"===e(a.html)?g(a.html):"string"===e(a.url)?
(q={},q.url=a.url+"?v"+a.version,q.success=function(a){g(a,!0);b.trigger("Ready")},q.error=function(a){b.trigger("Error",{error:a})},$.ajax(q)):"object"===e(a.el)&&h(a.el[0])&&g(a.el.html());b=new j.Object(l);!0===c&&b.trigger("Ready");"function"===e(b.init)&&b.init(b);b.on("Render",function(a,d){n(d)});return b},View:function(a){var b=r,c=b.typeOf,d=b.isElement,b=b.merge,e,h={elements:{}},f={},p=function(a,b){var m=d(a[0])?a:e.template.el,h="object"===c(b)?b:"object"===c(f.elements)?f.elements:null;
if(h)for(var j in h)h.hasOwnProperty(j)&&(e.elements[j]=m.find(h[j]))},k=function(a){var b=e.template,h="object"===c(a)?a:{},j="object"===c(h.el)&&d(h.el[0])?h.el:null;b&&(b.off("Rendered","thisview"),b.on("Rendered",function(){j&&(j.html(this.el),p(j));e.update=n;e.trigger("Template:Rendered");"object"===c(f.events)&&"function"===c(f.events["Template:Rendered"])&&f.events["Template:Rendered"].bind(e)()},"thisview"),b.render(a));return e},n=function(a,b){var f="object"===c(e.elements)?e.elements:
null,h="string"===typeof a?a:null,j="string"===typeof b||"number"===typeof b?b:"",k,n;f&&h&&(h=h.split(":"),a=h[0],"string"===typeof h[1]&&(k=h[1]),"undefined"!==typeof f[a]&&d(f[a][0])?n=f[a]:"string"===a&&(n=$(a)),"object"===c(n)&&d(n[0])&&(null===k||void 0===k?n.html(j):n.attr(k,j)));return e};a=c(a)?a:{};f="object"===c(this.config)?this.config:{};f=b(f,a);h.template=!0===f.extended&&"object"===c(f.template)&&"object"===c(f.template.config)?new $$.Microtemplate(f.template.config):"object"===c(f.template)?
f.template:null;h.render=k;h.gatherElements=p;e=new j.Object(h);"function"===c(e.init)&&e.init(e);e.on("Render",function(a,b){k(b)});return e},App:function(a){var b=new j.Object,c=r,d=c.typeOf,e=c.isElement,c={Router:{Default:""}},h,f={},p="object"===d(a)?a:{};a="string"===d(p.name)?p.name:Math.random().toString(36).substring(7);var e="object"===d(p.el)&&e(p.el[0])?p.el:$("body"),k="boolean"===typeof p.localStorage?p.localStorage:!0,n="object"===typeof p.versions?p.versions:{},g=a+"_templates",l=
a+"_data";n.templates="number"===typeof n.templates?n.templates:1;n.data="number"===typeof n.data?n.data:1;if(p)for(var m in p)p.hasOwnProperty(m)&&(c[m]=p[m]);c.versions=n;h=new j.Cache({size:1,id:g,localStorage:k});new j.Cache({size:1,id:l,localStorage:k});j._.defapp=b;j.Apps[a]=b;m=c.Router;var p={},q,u={},t,y=/\{([^}]+)\}/g;if("object"===typeof m){for(var w in m)if(m.hasOwnProperty(w)){k=w;g=k.split("/");""===g[0]&&g.splice(0,1);""===g[g.length-1]&&(g=g.splice(g.length-1,1));l=g.length;q=k.match(y);
n=[];if(q)for(var x=t=0;x<l;x++)q=g[x].match(y)?g[x]:void 0,void 0!==q?(q=q.substr(1,q.length-2),n.push(q),u[q]=void 0,t++):n.push(void 0);p[w]={event:m[w],route:k,len:l,split:g,variables:n,varkeys:u}}f=p}b.el=e;b.name=a;b.start=function(){b.trigger("Starting");var a=function(a){var d=a.substr(1,a.length-1),c;if(""===a)c={key:"Default",variables:{}};else a:{a=f;var d=d.split("/"),e=!1,g={},h;""===d[0]&&d.splice(0,1);""===d[d.length-1]&&(d=d.splice(0,d.length-1));h=d.length;for(c in a)if(a.hasOwnProperty(c)){if(h===
a[c].len){for(var e=!0,j=0;j<h;j++)d[j].toLowerCase()!==a[c].split[j].toLowerCase()&&(e=!1);if(!1===e)for(j=0;j<h&&!(e=d[j].toLowerCase()===a[c].split[j].toLowerCase()&&void 0===a[c].variables[j]?!0:d[j].toLowerCase()!==a[c].split[j].toLowerCase()&&void 0!==a[c].variables[j]?!0:!1,!1===e);j++);}c=!0===e?{key:a[c].event,variables:g}:{key:"Default",variables:void 0};break a}c=!1}b.trigger("Router:BeforeRouter");b.trigger("Router:"+c.key,c.variables)};if("onhashchange"in window)window.onhashchange=function(){a(window.location.hash)};
else{var c=window.location.hash,e;window.setInterval(function(){window.location.hash!=c&&(e=window.location.hash,a(e))},100)}a(window.location.hash);b.trigger("Started");b.on("a:click",function(a,c){var b;b=c.url;b="string"===d(b)?b:null;var e="";b?("#"!==b.charAt(0)&&"/"!==b.charAt(0)?e="#/"+b:"/"===b.charAt(0)?e="#"+b:"#"===b.charAt(0)&&"/"!==b.charAt(1)?(e=b.substring(b.length,2),e="#/"+e):e=b,b=e):b=null;e=c.el;b&&"false"!==e.attr("data-coreroute")&&(window.location=b)});return b};b.config=c;
c.Api&&(b.Api=new j.Api(c.Api));"boolean"!==d(c.routerOverrideLinks)&&(c.routerOverrideLinks=!0);b._={saveTemplate:function(a,b){var c=h.get()[0];"object"!==d(c)&&(c={});c[a]=b;h.add(c)},getTemplate:function(a){var b=h.get()[0];if("object"===d(b))return b[a]}};if(!0===c.routerOverrideLinks)e.on("click",function(a){var c=a.target,d=$(c),e=/(https?:\/\/[^\s]+)/g,f="";if("a"===c.nodeName||"A"===c.nodeName)f=d.attr("href"),f.match(e)?1===f.match(e).length&&(window.location=f):(a.preventDefault(),b.trigger("a:click",
{el:d,url:f}))});"function"===d(b.init)&&b.init(b);$(document).ready(function(){b.trigger("Ready")});return b},version:"0.3"};j.View.extend=function(a){var b={};b.config=a;b.config.extended=!0;return j.View.bind(b)};j.Data.extend=function(a){var b={};b.config=a;b.config.extended=!0;return j.Data.bind(b)};j.Controller.extend=function(a){var b={};b.config=a;b.config.extended=!0;return j.Controller.bind(b)};"function"===typeof define&&define.amd?define("Core",[],function(){return j}):"undefined"!==typeof module&&
"undefined"!==typeof exports&&module.exports?module.exports=j:z["string"===typeof t?t:"Core"]=j})(this,"$$");
