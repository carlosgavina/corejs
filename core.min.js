/* core.js v0.2.6b by @carlosgavina | hello@carlosgavina.com | https://github.com/carlosgavina/corejs */
(function(A,z){var q={typeOf:function(b){var c=typeof b;"object"===c&&null===b&&(null===b?c="null":"number"===typeof b.length&&(c="array"));return c},merge:function(b,c){var d={},a="object"===q.typeOf(b)?b:null,f="object"===q.typeOf(c)?c:null,g;if(a)for(g in a)a.hasOwnProperty(g)&&(d[g]=a[g]);if(f)for(g in f)f.hasOwnProperty(g)&&(d[g]=f[g]);return d},isElement:function(b){try{return b instanceof HTMLElement}catch(c){return"object"===typeof b&&1===b.nodeType&&"object"===typeof b.style&&"object"===
typeof b.ownerDocument}}},k={_:{},Apps:{},Tools:q,Object:function(b){var c=this,d=q.typeOf,a;a=document.createElement("p");var f={_:{_:$(a)}},g={},l=function(a,e,c){var h;e="string"===d(e)?e:"_";c="boolean"===d(c)?c:!0;if("string"===d(a)){h=a.split(":");1===h.length?(a="_",h=h[0]):(a=h[0],h=h[1]);if("object"!==d(f[a])&&!0===c)f[a]={};else if("object"!==d(f[a]))return;if("object"!==d(f[a][e])&&!0===c)f[a][e]=$(document.createElement("p"));else if("object"!==d(f[a][e]))return;return{context:e,name:h,
hub:f[a],event:f[a][e]}}};this._={};this._.clone=function(){Object.create||function(a){function e(){}e.prototype=a;return new e}};this._.implement=function(a){if(a)for(var e in a)a.hasOwnProperty(e)&&(c[e]=a[e]);return c};a=this._.clone(this);b&&this._.implement.call(a,b);this.on=function(a,e,b){e="function"===typeof e?e:void 0;a=l(a,b);if("object"===d(a)&&"function"===d(e))a.event.on(a.name,$.proxy(e,c));return c};this.trigger=function(a,e,b){var h="string"===d(b)?b:"all";a=l(a,b,!1);if("object"===
d(a))if("all"===h)for(var g in a.hub)a.hub.hasOwnProperty(g)&&a.hub[g].trigger(a.name,e);else a.event.trigger(a.name,e);return c};this.off=function(a,e){var b="string"===d(e)?e:"all",h=l(a,e,!1),g,j;if(void 0!==h)if(g=a.split(":"),g=1===g.length?null:h.name,"all"===b)for(j in h.hub)h.hub.hasOwnProperty(j)&&h.hub[j].off(g);else h.event.off(g);else for(j in f)if(f.hasOwnProperty(j))for(g in f[j])f[j].hasOwnProperty(g)&&f[j][g].off();return c};this.close=function(a){var e="object"===d(a)?a:{};a="boolean"===
d(e.clearData)?e.clearData:!0;e="boolean"===d(e.closeData)?e.closeData:!0;c.trigger("Before:Close");if(!0===e){var e=g,b;for(b in e)if("object"===d(e[b]))if("function"===d(e[b].close))e[b].close();else for(var h in e[b])"object"===d(e[b][h])&&"function"===d(e[b][h].close)&&e[b][h].close()}!0===a&&c.data(null);c.off()};this.data=function(a,e){if("object"!==d(e)&&"string"===d(a))return g[a];if("string"===d(a))g[a]=e;else if(null===a)g={};else if("undefined"===d(a))return g;return c};return a},Cache:function(b){var c=
{},d={},a={history:[],size:10,localStorage:!1,id:null},f=function(){var e;if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&"undefined"!==typeof localStorage)try{e=JSON.stringify(a.history),localStorage.setItem(a.id,e),c.trigger("LocalStorage:Save",{id:a.id,data:a.history})}catch(b){}};if("object"===typeof b)for(var g in b)b.hasOwnProperty(g)&&(a[g]=b[g]);var l;if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&
"undefined"!==typeof localStorage)try{l=JSON.parse(localStorage.getItem(a.id)),"object"===typeof l&&void 0!==l.length&&(a.history=l)}catch(s){}d={add:function(e){var b=a.history.length,d=a.size;"undefined"!==typeof e&&("object"==typeof e&&e.length?(a.history=a.history.concat(e),b=a.history.length,b>=d&&a.history.splice(0,b-d)):(b>=d&&a.history.shift(),a.history.push(e)));f();return c},get:function(){return a.history},remove:function(e){var c=a.history,b=a.history.length,d=!1;if("undefined"!==typeof e)for(;b--;)if(c[b]===
e){a.history.splice(b,1);d=!0;break}f();return d},exists:function(e){var c=a.history,b=a.history.length;if("undefined"!==typeof e)for(;b--;)if(c[b]===e)return b;return!1},addUnique:function(e){var b=a.history,d=a.history.length;if("undefined"!==typeof e)for(;d--;)if(b[d]===e){a.history.splice(d,1);break}a.history.push(e);f();return c},setMaxSize:function(e){a.size="number"===typeof e?e:10;return c},resetCache:function(){a.history=[];f()},removeAtIndex:function(e){if("number"===typeof e)return e<a.history.length?
(a.history.splice(e,1),!0):!1;f()},setLocalStorage:function(e){a.localStorage="boolean"===typeof e?e:a.localStorage}};return c=new k.Object(d)},Api:function(b){var c,d={},a=q.typeOf,f=q.merge,g={protocol:"http://",timeout:1E4,async:!0},l={},s={},e=function(a,e,b,d){b.success=function(a){d.trigger("Success",a);c.trigger("Success",a)};b.error=function(a,e){var b={error:{id:2,description:e,response:a.response,xhr:a}},g="Error";if("timeout"===e||"Timeout"===e)g="Timeout";d.trigger(g,b);c.trigger(g,b)};
b.type=a;b.url=b.protocol+s.url+e.endpoint;a=$.ajax(b);d.request=a;return d},m=function(e,b,d){var h=null,j="Unknown";"string"===a(e)&&"object"===a(l[e])?(e="object"===a(l[e].options)?l[e].options:null,h=f(g,e),h=f(h,b)):("string"===a(e)&&(j=e),d.trigger("Error",{error:{id:1,description:"Request '"+j+"' doesn't exist."}}),c.trigger("Error",{error:{id:1,description:"Request '"+j+"' doesn't exist."}}));return h},h;for(h in b)if("requests"!==h&&"url"!==h)g[h]=b[h];else if("requests"===h){var n=b[h];
if("object"===a(n)){var j=void 0;for(j in n)if(n.hasOwnProperty(j)){var v=j,t=n[j];"string"===a(t.endpoint)&&(l[v]=t)}}else"string"===a(n)&&"string"===a(void 0)&&"string"===a((void 0).endpoint)&&(l[n]=void 0)}else"url"===h&&(s[h]=b[h]);d.post=function(a,b){var c=new k.Object,d=m(a,b,c);d&&e("POST",l[a],d,c);return c};d.get=function(a,b){var c=new k.Object,d=m(a,b,c);d&&e("GET",l[a],d,c);return c};return c=new k.Object(d)},Controller:function(b){var c=q.typeOf;b="object"===c(b)?b:{};var d="string"===
c(b.appname)?b.appname:null;d&&"object"===c(k.Apps[d])?b.app=k.Apps[d]:"object"===c(k._)&&"object"===c(k._.defapp)&&(b.app=k._.defapp);b=new k.Object(b);"function"===c(b.init)&&b.init(b);return b},Data:function(b){var c,d=q.typeOf,a=q.merge,f={},g=!1,l=function(e,b){var g="string"===d(f.request)?f.request:null,l="object"===d(f.app.Api)?f.app.Api:null,j="string"===d(f.pushkey)?f.pushkey:null,k,s,p="object"===d(b)?b:{},q="string"===d(p.method)?p.method:null,r="object"===d(p.data)?p.data:null,u;!q&&
"push"===e?(q="post",u="Push",k="boolean"===d(p.update)?p.update:!1,s="boolean"===d(p.merge)?p.merge:!1):!q&&"pull"===e&&(q="get",u="Pull",k="boolean"===d(p.update)?p.update:!0,s="boolean"===d(p.merge)?p.merge:!0);null===r&&(r="object"===d(c.attributes)?c.attributes:{});p.data=r;g&&l&&(g=l[q](g,p),g.on("Success",function(e,b){r=j&&"undefined"!==d(b[j])?b[j]:b;!0===s&&(r=a(r,c.attributes));!0===k&&c.set(r);c.trigger(u+":Success",r)}),g.on("Error",function(a,b){c.trigger(u+":Error",b)}),g.on("Timeout",
function(a,b){c.trigger(u+":Timeout",b)}));return c},s="string"===d(b.appname)?b.appname:null;b="object"===d(b)?b:{};f=a(b,{attributes:{}});s&&"object"===d(k.Apps[s])?f.app=k.Apps[s]:"object"===d(k._)&&"object"===d(k._.defapp)&&(f.app=k._.defapp);f.id&&f.attributes&&!g&&(g=new k.Cache({size:1,id:f.id,localStorage:!0}),g.get()[0]!=={}||""!==g.get()[0]?f.attributes=g.get()[0]:g.add(f.attributes));f.set=function(a,b){if("object"===typeof a)c.attributes=a,c.trigger("Change",{newdata:a});else if("string"===
typeof a)"object"!==d(c.attributes)&&(c.attributes={}),c.attributes[a]=b,c.trigger("Change:"+a,{newdata:b});else return!1;var h="string"===d(f.id)?f.id:null;h&&(g||(g=new k.Cache({size:1,id:h,localStorage:!0})),g.add(c.attributes));return c};f.get=function(a){var b=c.attributes;return"string"===typeof a?b[a]:b};f.pull=function(a){return l("pull",a)};f.push=function(a){return l("push",a)};c=new k.Object(f);"function"===d(c.init)&&c.init(c);return c},Microtemplate:function(b){var c=/\{{([^}]+)\}}/g,
d={render:function(b){b="object"===typeof b?b:{};b="object"===typeof b.variables?b.variables:void 0;b="object"===typeof b?b:"object"===typeof a.arg.variables?a.arg.variables:null;var f,k,e,m;f=a.template;var h=document.createElement(a.elType);if(b&&"string"===typeof f){k=f.match(c);if(null!==k)for(var n=e=k.length;n--;)e=k[n],m=k[n].slice(2,k[n].length-2),f=f.replace(e,b[m]);a.rendered=f;h.innerHTML=f;a.el=$(f);d.onDone()}else"string"===typeof f&&(a.rendered=f,h.innerHTML=f,a.el=$(f),d.onDone());
return a},onDone:function(){"function"===typeof a.arg.render&&a.arg.render(a)},getT:function(b){"undefined"!==typeof("string"===typeof a.template?a.template:void 0)&&!1===b?("function"===typeof a.arg.loaded&&a.arg.loaded(a),"function"===typeof d.onDone&&d.render(a)):"string"===typeof a.url&&$.ajax({url:a.url+"?v="+a.version,async:!0,success:function(b){a.template=b;a.el=$(b);"function"===typeof a.arg.loaded&&a.arg.loaded(a);"function"===typeof d.onDone&&d.render(a.template)},error:function(){return null}})}},
a={elType:"div",arg:b,url:void 0,template:void 0,rendered:void 0,version:0,render:d.render},f="boolean"===typeof b.force?b.force:!1;a.arg=b;"string"===typeof b.html?(a.template=b.html,"function"===typeof b.loaded&&b.loaded(a),d.render()):"string"===typeof b.url&&(a.url=b.url,d.getT(f));a.version="number"===typeof b.version?b.version:"object"===typeof k._&&"object"===typeof k._.defapp&&"object"===typeof k._.defapp.config&&"object"===typeof k._.defapp.config.versions&&"number"===typeof k._.defapp.config.versions.templates?
k._.defapp.config.versions.templates:1;return a},View:function(b){return new function(){var c=new k.Object,d={},a,f,g=q.isElement,l=function(b){var g,h="object"===typeof b?b:{},j="function"===typeof h.onSuccess?h.onSuccess:function(){},k=function(a){if(e){e.html(a);for(var b in d)d.hasOwnProperty(b)&&(m[b]=e.find(d[b]))}c.elements=m};if(!0===f)g=a.render(b),c.template=g,k(g.el),j(c),c.trigger("TemplateRendered",c);else c.on("TemplateReady",function(a,b){g=b;c.template=g;k(g.el);j(c);(void 0).trigger("TemplateRendered",
c)});return c},s=function(a,b){var e="string"===typeof a?a:null,d="string"===typeof b||"number"===typeof b?b:"",f,h=null,j;e&&(e=e.split(":"),f=e[0],"string"===typeof e[1]&&(h=e[1]),"undefined"!==typeof m[f]&&g(m[f][0])?j=m[f]:"string"===f&&(j=$(f)),null===h?j.html(d):j.attr(h,d));return c},e=null,m={},h=k,n=h.Apps,j="object"===typeof b?b:{},v="string"===typeof j.html?j.html:null,t="string"===typeof j.url?j.url:null,p="string"===typeof j.storageID?j.storageID:null,w="boolean"===typeof j.appstorage?
j.appstorage:!0,r="string"===typeof j.appname?j.appname:null;f=!1;!0===w&&p&&(!r&&"object"===typeof h._.defapp&&(r=h._.defapp.name),r&&("object"===typeof n&&"object"===typeof n[r])&&(h=n[r],h._.getTemplate(p,{url:t,html:v,loaded:function(b){a=b;f=!0;c.trigger("TemplateReady",a)}})));d="object"===typeof j.elements?j.elements:{};return function(a){a="object"===typeof a?a:{};e="object"===typeof a.el&&g(a.el[0])?a.el:"string"===typeof a.el?$(a.el):null;c.el=e;c.render=l;c.update=s;c.elements=m;c.events=
void 0;return c}}},App:function(b){var c=new k.Object,d=q,a=d.typeOf,f=k.Microtemplate,d=d.isElement,g={Router:{Default:""}},l={},s={},e=function(a,b,e){var c="object"===typeof l.Templates.get()[0]?l.Templates.get()[0]:!1,d=g.versions.templates;if(!c||"object"!==typeof c.templates)c={templates:{}},c.version=d;c.templates[a]={version:e,html:b};l.Templates.add(c)},m="object"===a(b)?b:{};b="string"===a(m.name)?m.name:Math.random().toString(36).substring(7);var d="object"===a(m.el)&&d(m.el[0])?m.el:$("body"),
h="boolean"===typeof m.localStorage?m.localStorage:!1,n="object"===typeof m.versions?m.versions:{},j=b+"_templates",v=b+"_data";n.templates="number"===typeof n.templates?n.templates:1;n.data="number"===typeof n.data?n.data:1;if(m)for(var t in m)m.hasOwnProperty(t)&&(g[t]=m[t]);g.versions=n;l.Templates=new k.Cache({size:1,id:j,localStorage:h});l.Data=new k.Cache({size:1,id:v,localStorage:h});k._.defapp=c;k.Apps[b]=c;t=g.Router;var m={},p,w={},r,u=/\{([^}]+)\}/g;if("object"===typeof t){for(var x in t)if(t.hasOwnProperty(x)){h=
x;j=h.split("/");""===j[0]&&j.splice(0,1);""===j[j.length-1]&&(j=j.splice(j.length-1,1));v=j.length;p=h.match(u);n=[];if(p)for(var y=r=0;y<v;y++)p=j[y].match(u)?j[y]:void 0,void 0!==p?(p=p.substr(1,p.length-2),n.push(p),w[p]=void 0,r++):n.push(void 0);m[x]={event:t[x],route:h,len:v,split:j,variables:n,varkeys:w}}s=m}c.el=d;c.name=b;c.start=function(){c.trigger("Starting");var b=function(a){var b=a.substr(1,a.length-1),e;if(""===a)e={key:"Default",variables:{}};else a:{a=s;var b=b.split("/"),d=!1,
f={},g;""===b[0]&&b.splice(0,1);""===b[b.length-1]&&(b=b.splice(0,b.length-1));g=b.length;for(e in a)if(a.hasOwnProperty(e)){if(g===a[e].len){for(var d=!0,h=0;h<g;h++)b[h].toLowerCase()!==a[e].split[h].toLowerCase()&&(d=!1);if(!1===d)for(h=0;h<g;h++)b[h].toLowerCase()===a[e].split[h].toLowerCase()||void 0!==a[e].variables[h]?(void 0!==a[e].variables[h]&&(f[a[e].variables[h]]=b[h]),d=!0):d=!1}if(!0===d){e={key:a[e].event,variables:f};break a}}e=!1}c.trigger("Router:BeforeRouter");c.trigger("Router:"+
e.key,{variables:e.variables,self:c})};if("onhashchange"in window)window.onhashchange=function(){b(window.location.hash)};else{var e=window.location.hash,d;window.setInterval(function(){window.location.hash!=e&&(d=window.location.hash,b(d))},100)}b(window.location.hash);c.on("a:click",function(b,e){var c;c=e.url;c="string"===a(c)?c:null;var d="";c?("#"!==c.charAt(0)&&"/"!==c.charAt(0)?d="#/"+c:"/"===c.charAt(0)?d="#"+c:"#"===c.charAt(0)&&"/"!==c.charAt(1)?(d=c.substring(c.length,2),d="#/"+d):d=c,
c=d):c=null;d=e.el;c&&"false"!==d.attr("data-coreroute")&&(window.location=c)});return c};c.config=g;g.Api&&(c.Api=new k.Api(g.Api));"boolean"!==a(g.routerOverrideLinks)&&(g.routerOverrideLinks=!0);c._={saveTemplate:e,getTemplate:function(a,b){var c="object"===typeof b?b:{},d="object"===typeof l.Templates.get()[0]?l.Templates.get()[0]:!1,h=g.versions.templates,j="number"===typeof c.version?c.version:1,k="function"===typeof b.loaded?b.loaded:!1,c=!0;if(d)if("number"===typeof d.version&&d.version===
h){if("object"===typeof d.templates&&"object"===typeof d.templates[a]){c=!1;var d=d.templates[a],h="string"===typeof d.html?d.html:"...",m="function"===typeof b.loaded?b.loaded:!1;("number"===typeof d.version?d.version:1)===j?(b.url=null,b.html=h):b.loaded=function(b){e(a,b.template,j);m&&m(b)};d=new f(b);return d}}else l.Templates.resetCache();if(!0===c)return b.loaded=function(b){e(a,b.template,j);k&&k(b)},new f(b,!0)},saveData:function(){},getData:function(){}};if(!0===g.routerOverrideLinks)d.on("click",
function(a){var b=a.target,d=$(b),e=/(https?:\/\/[^\s]+)/g,f="";if("a"===b.nodeName||"A"===b.nodeName)f=d.attr("href"),f.match(e)?1===f.match(e).length&&(window.location=f):(a.preventDefault(),c.trigger("a:click",{el:d,url:f}))});return c},version:"0.2.5"};"function"===typeof define&&define.amd?define("Core",[],function(){return k}):"undefined"!==typeof module&&"undefined"!==typeof exports&&module.exports?module.exports=k:A["string"===typeof z?z:"Core"]=k})(this,"$$");
