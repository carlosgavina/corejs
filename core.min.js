/* core.js v0.2.1 by @carlosgavina | hello@carlosgavina.com | https://github.com/carlosgavina/corejs */
(function(z,t){var q={typeOf:function(b){var c=typeof b;"object"===c&&null===b&&(null===b?c="null":"number"===typeof b.length&&(c="array"));return c},merge:function(b,c){var d={},a="object"===q.typeOf(b)?b:null,g="object"===q.typeOf(c)?c:null,m;if(a)for(m in a)d[m]=a[m];if(g)for(m in g)d[m]=g[m];return d}},h={_:{},Apps:{},Tools:q,Object:function(b){var c=this,d=q.typeOf,a=document.createElement("p"),g={_:{_:$(a)}},m=function(a,c,f){var b;c="string"===d(c)?c:"_";f="boolean"===d(f)?f:!0;if("string"===
d(a)){b=a.split(":");1===b.length?(a="_",b=b[0]):(a=b[0],b=b[1]);if("object"!==d(g[a])&&!0===f)g[a]={};else if("object"!==d(g[a]))return;if("object"!==d(g[a][c])&&!0===f)g[a][c]=$(document.createElement("p"));else if("object"!==d(g[a][c]))return;return{context:c,name:b,hub:g[a],event:g[a][c]}}};this._={};this._.clone=function(){Object.create||function(a){function c(){}c.prototype=a;return new c}};this._.implement=function(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};instance=
this._.clone(this);b&&this._.implement.call(instance,b);this.on=function(a,b,f){b="function"===typeof b?b:void 0;a=m(a,f);if("object"===d(a)&&"function"===d(b))a.event.on(a.name,$.proxy(b,c));return c};this.trigger=function(a,b,f){var k="string"===d(f)?f:"all";a=m(a,f,!1);if("object"===d(a))if("all"===k)for(var e in a.hub)a.hub[e].trigger(a.name,b);else a.event.trigger(a.name,b);return c};this.off=function(a,b){var f="string"===d(b)?b:"all",k=m(a,b,!1),e,j;if(void 0!==k)if(e=a.split(":"),e=1===e.length?
null:k.name,"all"===f)for(j in k.hub)k.hub[j].off(e);else k.event.off(e);else for(j in g)for(e in g[j])g[j][e].off();return c};return instance},Cache:function(b){var c={},d={},a={history:[],size:10,localStorage:!1,id:null},g=function(){var b;if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&"undefined"!==typeof localStorage)try{b=JSON.stringify(a.history),localStorage.setItem(a.id,b),c.trigger("LocalStorage:Save",{id:a.id,data:a.history})}catch(d){}};
if("object"===typeof b)for(var m in b)a[m]=b[m];var n;if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&"undefined"!==typeof localStorage)try{n=JSON.parse(localStorage.getItem(a.id)),"object"===typeof n&&void 0!==n.length&&(a.history=n)}catch(p){}d={add:function(b){var d=a.history.length,e=a.size;"undefined"!==typeof b&&("object"==typeof b&&b.length?(a.history=a.history.concat(b),d=a.history.length,d>=e&&a.history.splice(0,d-e)):(d>=e&&a.history.shift(),
a.history.push(b)));g();return c},get:function(){return a.history},remove:function(b){var c=a.history,e=a.history.length,d=!1;if("undefined"!==typeof b)for(;e--;)if(c[e]===b){a.history.splice(e,1);d=!0;break}g();return d},exists:function(b){var c=a.history,d=a.history.length;if("undefined"!==typeof b)for(;d--;)if(c[d]===b)return d;return!1},addUnique:function(b){var d=a.history,e=a.history.length;if("undefined"!==typeof b)for(;e--;)if(d[e]===b){a.history.splice(e,1);break}a.history.push(b);g();return c},
setMaxSize:function(b){a.size="number"===typeof b?b:detaults.size;return c},resetCache:function(){a.history=[];g()},removeAtIndex:function(b){if("number"===typeof b)return b<a.history.length?(a.history.splice(b,1),!0):!1;g()},setLocalStorage:function(b){a.localStorage="boolean"===typeof b?b:a.localStorage}};return c=new h.Object(d)},Api:function(b){var c,d={},a=q.typeOf,g=q.merge,m={protocol:"http://",timeout:1E4,async:!0},n={},p={},f=function(a,b,d,e){d.success=function(a){e.trigger("Success",a);
c.trigger("Success",a)};d.error=function(a,b){var d={error:{id:2,description:b,response:a.response,xhr:a}},f="Error";if("timeout"===b||"Timeout"===b)f="Timeout";e.trigger(f,d);c.trigger(f,d)};d.type=a;d.url=d.protocol+p.url+b.endpoint;a=$.ajax(d);e.request=a;return e},k=function(b,d,e){var f=null,j="Unknown";"string"===a(b)&&"object"===a(n[b])?(b="object"===a(n[b].options)?n[b].options:null,f=g(m,b),f=g(f,d)):("string"===a(b)&&(j=b),e.trigger("Error",{error:{id:1,description:"Request '"+j+"' doesn't exist."}}),
c.trigger("Error",{error:{id:1,description:"Request '"+j+"' doesn't exist."}}));return f},e;for(e in b)if("requests"!==e&&"url"!==e)m[e]=b[e];else if("requests"===e){var j=b[e];if("object"===a(j)){var l=void 0;for(l in j){var x=l,r=j[l];"string"===a(r.endpoint)&&(n[x]=r)}}else"string"===a(j)&&"string"===a(void 0)&&"string"===a((void 0).endpoint)&&(n[j]=void 0)}else"url"===e&&(p[e]=b[e]);d.post=function(a,b){var c=new h.Object,d=k(a,b,c);d&&f("POST",n[a],d,c);return c};d.get=function(a,b){var c=new h.Object,
d=k(a,b,c);d&&f("GET",n[a],d,c);return c};return c=new h.Object(d)},Controller:function(b){var c=q.typeOf;b="object"===c(b)?b:{};var d="string"===c(b.appname)?b.appname:null;d&&"object"===c(h.Apps[d])?b.app=h.Apps[d]:"object"===c(h._)&&"object"===c(h._.defapp)&&(b.app=h._.defapp);b=new h.Object(b);"function"===c(b.init)&&b.init(b);return b},Data:function(b){return new function(){var c={},d,a={},g="object"===typeof b?b:{};(g="object"===typeof g.attributes?g.attributes:null)&&(a=g);return function(b){var g=
null,p=null,f=a,k="object"===typeof b?b:{};b="string"===typeof k.storageID?k.storageID:null;k="object"===typeof k.data?k.data:null;b&&(g=b,p=new h.Cache({size:1,id:b,localStorage:!0}));"object"===typeof k&&null!==k?(f=k,p&&p.add(f)):p&&(b=p.get()[0],"undefined"!==typeof b&&(f=p.get()[0]));c={get:function(a){return"string"===typeof a?f[a]:f},set:function(a,b){return"object"===typeof a?(f=a,d.trigger("Change",{Data:d,newdata:a}),d):"string"===typeof a?(f[a]=b,d.trigger("Change:"+a,{Data:d,id:a,newdata:b}),
d):!1},save:function(a){if(a="string"===typeof a&&0<a.length?a:g)p||(p=new h.Cache({size:1,id:a,localStorage:!0})),p.add(f)},attributes:f};return d=new h.Object(c)}}},Microtemplate:function(b){var c=/\{{([^}]+)\}}/g,d={render:function(b){b="object"===typeof b?b:{};b="object"===typeof b.variables?b.variables:void 0;b="object"===typeof b?b:"object"===typeof a.arg.variables?a.arg.variables:null;var g,h,f,k;g=a.template;var e=document.createElement(a.elType);if(b&&"string"===typeof g){h=g.match(c);if(null!==
h)for(var j=f=h.length;j--;)f=h[j],k=h[j].slice(2,h[j].length-2),g=g.replace(f,b[k]);a.rendered=g;e.innerHTML=g;a.el=$(g);d.onDone()}else"string"===typeof g&&(a.rendered=g,e.innerHTML=g,a.el=$(g),d.onDone());return a},onDone:function(){"function"===typeof a.arg.render&&a.arg.render(a)},getT:function(b){"undefined"!==typeof("string"===typeof a.template?a.template:void 0)&&!1===b?("function"===typeof a.arg.loaded&&a.arg.loaded(a),"function"===typeof d.onDone&&d.render(a)):"string"===typeof a.url&&$.ajax({url:a.url+
"?v="+a.version,async:!0,success:function(b){a.template=b;a.el=$(b);"function"===typeof a.arg.loaded&&a.arg.loaded(a);"function"===typeof d.onDone&&d.render(a.template)},error:function(){return null}})}},a={elType:"div",arg:b,url:void 0,template:void 0,rendered:void 0,version:0,render:d.render},g="boolean"===typeof b.force?b.force:!1;a.arg=b;"string"===typeof b.html?(a.template=b.html,"function"===typeof b.loaded&&b.loaded(a),d.render()):"string"===typeof b.url&&(a.url=b.url,d.getT(g));a.version=
"number"===typeof b.version?b.version:"object"===typeof h._&&"object"===typeof h._.defapp&&"object"===typeof h._.defapp.config&&"object"===typeof h._.defapp.config.versions&&"number"===typeof h._.defapp.config.versions.templates?h._.defapp.config.versions.templates:1;return a},View:function(b){return new function(){var c=new h.Object,d={},a,g,m=function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===typeof a.ownerDocument}},
n=function(b){var e,h="object"===typeof b?b:{},j="function"===typeof h.onSuccess?h.onSuccess:function(){};gatherElements=function(a){if(f){f.html(a);for(var b in d)k[b]=f.find(d[b])}c.elements=k};if(!0===g)e=a.render(b),c.template=e,gatherElements(e.el),j(c),c.trigger("TemplateRendered",c);else c.on("TemplateReady",function(a,b){e=b;c.template=e;gatherElements(e.el);j(c);(void 0).trigger("TemplateRendered",c)});return c},p=function(a,b){var d="string"===typeof a?a:null,e="string"===typeof b||"number"===
typeof b?b:"",f,g=null,h;d&&(d=d.split(":"),f=d[0],"string"===typeof d[1]&&(g=d[1]),"undefined"!==typeof k[f]&&m(k[f][0])?h=k[f]:"string"===f&&(h=$(f)),null===g?h.html(e):h.attr(g,e));return c},f=null,k={},e=h,j=e.Apps,l="object"===typeof b?b:{},x="string"===typeof l.html?l.html:null,r="string"===typeof l.url?l.url:null,q="string"===typeof l.storageID?l.storageID:null,u="boolean"===typeof l.appstorage?l.appstorage:!0,s="string"===typeof l.appname?l.appname:null;g=!1;!0===u&&q&&(!s&&"object"===typeof e._.defapp&&
(s=e._.defapp.name),s&&("object"===typeof j&&"object"===typeof j[s])&&(e=j[s],e._.getTemplate(q,{url:r,html:x,loaded:function(b){a=b;g=!0;c.trigger("TemplateReady",a)}})));d="object"===typeof l.elements?l.elements:{};return function(a){a="object"===typeof a?a:{};f="object"===typeof a.el&&m(a.el[0])?a.el:"string"===typeof a.el?$(a.el):null;c.el=f;c.render=n;c.update=p;c.elements=k;c.events=void 0;return c}}},App:function(b){var c=new h.Object,d={Router:{Default:""}},a={},g={},m=h.Microtemplate,n=function(b,
c,f){var e="object"===typeof a.Templates.get()[0]?a.Templates.get()[0]:!1,g=d.versions.templates;if(!e||"object"!==typeof e.templates)e={templates:{}},e.version=g;e.templates[b]={version:f,html:c};a.Templates.add(e)},p=function(a){var b=g;a=a.split("/");var d=!1,c={};""===a[0]&&a.splice(0,1);""===a[a.length-1]&&(a=a.splice(a.length-1,1));request_split_len=a.length;for(var e in b){if(request_split_len===b[e].len){for(var d=!0,f=0;f<request_split_len;f++)a[f].toLowerCase()!==b[e].split[f].toLowerCase()&&
(d=!1);if(!1===d)for(f=0;f<request_split_len;f++)a[f].toLowerCase()===b[e].split[f].toLowerCase()||void 0!==b[e].variables[f]?(void 0!==b[e].variables[f]&&(c[b[e].variables[f]]=a[f]),d=!0):d=!1}if(!0===d)return{key:e,variables:c}}return!1},f="object"===typeof b?b:{};b="string"===typeof f.name?f.name:Math.random().toString(36).substring(7);var k="undefined"!==typeof f.el&&isElement(f.el[0])?f.el:$("body"),e="boolean"===typeof f.localStorage?f.localStorage:!1,j="object"===typeof f.versions?f.versions:
{},l=b+"_data";j.templates="number"===typeof j.templates?j.templates:1;j.data="number"===typeof j.data?j.data:1;if(f)for(var q in f)d[q]=f[q];d.versions=j;a.Templates=new h.Cache({size:1,id:b+"_templates",localStorage:e});a.Data=new h.Cache({size:1,id:l,localStorage:e});h._.defapp=c;h.Apps[b]=c;q=d.Router;var f={},r,w,u={},s,t=/\{([^}]+)\}/g;if("object"===typeof q){for(var y in q){e=q[y];l=e.split("/");""===l[0]&&l.splice(0,1);""===l[l.length-1]&&(l=l.splice(l.length-1,1));w=l.length;r=e.match(t);
j=[];if(r)for(var v=s=0;v<w;v++)r=l[v].match(t)?l[v]:void 0,void 0!==r?(r=r.substr(1,r.length-2),j.push(r),u[r]=void 0,s++):j.push(void 0);f[y]={route:e,len:w,split:l,variables:j,varkeys:u}}g=f}c.el=k;c.name=b;c.services={};c.start=function(){var a=function(a){var b=a.substr(1,a.length-1);a=""===a?{key:"Default",variables:{}}:p(b);c.trigger("Router:"+a.key,{variables:a.variables,self:c})};if("onhashchange"in window)window.onhashchange=function(){a(window.location.hash)};else{var b=window.location.hash,
d;window.setInterval(function(){window.location.hash!=b&&(d=window.location.hash,a(d))},100)}a(window.location.hash);return c};c.config=d;c.translateRoute=p;d.Api&&(c.Api=new $$.Api(d.Api));c.Data="object"===typeof d.Data?d.Data:{};c.Views="object"===typeof d.Views?d.Views:{};c._={saveTemplate:n,getTemplate:function(b,c){var f="object"===typeof c?c:{},e="object"===typeof a.Templates.get()[0]?a.Templates.get()[0]:!1,g=d.versions.templates,h="number"===typeof f.version?f.version:1,j="function"===typeof c.loaded?
c.loaded:!1,f=!0;if(e)if("number"===typeof e.version&&e.version===g){if("object"===typeof e.templates&&"object"===typeof e.templates[b]){f=!1;var e=e.templates[b],g="string"===typeof e.html?e.html:"...",k="function"===typeof c.loaded?c.loaded:!1;("number"===typeof e.version?e.version:1)===h?(c.url=null,c.html=g):c.loaded=function(a){n(b,a.template,h);k&&k(a)};e=new m(c);return e}}else a.Templates.resetCache();if(!0===f)return c.loaded=function(a){n(b,a.template,h);j&&j(a)},new m(c,!0)},saveData:function(){},
getData:function(){}};return c}};"function"===typeof define&&define.amd?define("Core",[],function(){return h}):"undefined"!==typeof module&&"undefined"!==typeof exports&&module.exports?module.exports=h:z["string"===typeof t?t:"Core"]=h})(this,"$$");
