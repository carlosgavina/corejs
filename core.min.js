/* core.js v0.2.6c by @carlosgavina | hello@carlosgavina.com | https://github.com/carlosgavina/corejs */
(function(A,z){var q={typeOf:function(b){var e=typeof b;"object"===e&&null===b&&(null===b?e="null":"number"===typeof b.length&&(e="array"));return e},merge:function(b,e){var c={},a="object"===q.typeOf(b)?b:null,g="object"===q.typeOf(e)?e:null,h;if(a)for(h in a)a.hasOwnProperty(h)&&(c[h]=a[h]);if(g)for(h in g)g.hasOwnProperty(h)&&(c[h]=g[h]);return c},isElement:function(b){try{return b instanceof HTMLElement}catch(e){return"object"===typeof b&&1===b.nodeType&&"object"===typeof b.style&&"object"===
typeof b.ownerDocument}}},j={_:{},Apps:{},Tools:q,Object:function(b){var e=this,c=q.typeOf,a;a=document.createElement("p");var g={_:{_:$(a)}},h={},l=function(a,d,e){var f;d="string"===c(d)?d:"_";e="boolean"===c(e)?e:!0;if("string"===c(a)){f=a.split(":");1===f.length?(a="_",f=f[0]):(a=f[0],f=f[1]);if("object"!==c(g[a])&&!0===e)g[a]={};else if("object"!==c(g[a]))return;if("object"!==c(g[a][d])&&!0===e)g[a][d]=$(document.createElement("p"));else if("object"!==c(g[a][d]))return;return{context:d,name:f,
hub:g[a],event:g[a][d]}}};this._={};this._.clone=function(){Object.create||function(a){function d(){}d.prototype=a;return new d}};this._.implement=function(a){if(a)for(var d in a)a.hasOwnProperty(d)&&(e[d]=a[d]);return e};a=this._.clone(this);b&&this._.implement.call(a,b);this.on=function(a,d,b){d="function"===typeof d?d:void 0;a=l(a,b);if("object"===c(a)&&"function"===c(d))a.event.on(a.name,$.proxy(d,e));return e};this.trigger=function(a,d,b){var f="string"===c(b)?b:"all";a=l(a,b,!1);b=a.hub;if("object"===
c(a))if("all"===f)for(var h in b)b.hasOwnProperty(h)&&b[h].trigger(a.name,d);else a.event.trigger(a.name,d);return e};this.off=function(a,d){var b="string"===c(d)?d:"all",f=l(a,d,!1),h,k,j=f.hub;if(void 0!==f)if(h=a.split(":"),h=1===h.length?null:f.name,"all"===b)for(k in j)j.hasOwnProperty(k)&&j[k].off(h);else f.event.off(h);else for(k in g)if(g.hasOwnProperty(k))for(h in g[k])g[k].hasOwnProperty(h)&&g[k][h].off();return e};this.close=function(a){var d="object"===c(a)?a:{};a="boolean"===c(d.clearData)?
d.clearData:!0;d="boolean"===c(d.closeData)?d.closeData:!0;e.trigger("Before:Close");if(!0===d){var d=h,b;for(b in d)if("object"===c(d[b]))if("function"===c(d[b].close))d[b].close();else for(var f in d[b])"object"===c(d[b][f])&&"function"===c(d[b][f].close)&&d[b][f].close()}!0===a&&e.data(null);e.off()};this.data=function(a,d){if("object"!==c(d)&&"string"===c(a))return h[a];if("string"===c(a))h[a]=d;else if(null===a)h={};else if("undefined"===c(a))return h;return e};return a},Cache:function(b){var e=
{},c={},a={history:[],size:10,localStorage:!1,id:null},g=function(){var d;if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&"undefined"!==typeof localStorage)try{d=JSON.stringify(a.history),localStorage.setItem(a.id,d),e.trigger("LocalStorage:Save",{id:a.id,data:a.history})}catch(b){}};if("object"===typeof b)for(var h in b)b.hasOwnProperty(h)&&(a[h]=b[h]);var l;if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&
"undefined"!==typeof localStorage)try{l=JSON.parse(localStorage.getItem(a.id)),"object"===typeof l&&void 0!==l.length&&(a.history=l)}catch(s){}c={add:function(d){var b=a.history.length,c=a.size;"undefined"!==typeof d&&("object"==typeof d&&d.length?(a.history=a.history.concat(d),b=a.history.length,b>=c&&a.history.splice(0,b-c)):(b>=c&&a.history.shift(),a.history.push(d)));g();return e},get:function(){return a.history},remove:function(d){var e=a.history,b=a.history.length,c=!1;if("undefined"!==typeof d)for(;b--;)if(e[b]===
d){a.history.splice(b,1);c=!0;break}g();return c},exists:function(d){var e=a.history,b=a.history.length;if("undefined"!==typeof d)for(;b--;)if(e[b]===d)return b;return!1},addUnique:function(d){var b=a.history,c=a.history.length;if("undefined"!==typeof d)for(;c--;)if(b[c]===d){a.history.splice(c,1);break}a.history.push(d);g();return e},setMaxSize:function(d){a.size="number"===typeof d?d:10;return e},resetCache:function(){a.history=[];g()},removeAtIndex:function(d){if("number"===typeof d)return d<a.history.length?
(a.history.splice(d,1),!0):!1;g()},setLocalStorage:function(d){a.localStorage="boolean"===typeof d?d:a.localStorage}};return e=new j.Object(c)},Api:function(b){var e,c={},a=q.typeOf,g=q.merge,h={protocol:"http://",timeout:1E4,async:!0},l={},s={},d=function(a,d,b,c){b.success=function(a){c.trigger("Success",a);e.trigger("Success",a)};b.error=function(a,b){var d={error:{id:2,description:b,response:a.response,xhr:a}},h="Error";if("timeout"===b||"Timeout"===b)h="Timeout";c.trigger(h,d);e.trigger(h,d)};
b.type=a;b.url=b.protocol+s.url+d.endpoint;a=$.ajax(b);c.request=a;return c},m=function(b,d,c){var f=null,k="Unknown";"string"===a(b)&&"object"===a(l[b])?(b="object"===a(l[b].options)?l[b].options:null,f=g(h,b),f=g(f,d)):("string"===a(b)&&(k=b),c.trigger("Error",{error:{id:1,description:"Request '"+k+"' doesn't exist."}}),e.trigger("Error",{error:{id:1,description:"Request '"+k+"' doesn't exist."}}));return f},f;for(f in b)if("requests"!==f&&"url"!==f)h[f]=b[f];else if("requests"===f){var n=b[f];
if("object"===a(n)){var k=void 0;for(k in n)if(n.hasOwnProperty(k)){var u=k,t=n[k];"string"===a(t.endpoint)&&(l[u]=t)}}else"string"===a(n)&&"string"===a(void 0)&&"string"===a((void 0).endpoint)&&(l[n]=void 0)}else"url"===f&&(s[f]=b[f]);c.post=function(a,b){var e=new j.Object,c=m(a,b,e);c&&d("POST",l[a],c,e);return e};c.get=function(a,b){var e=new j.Object,c=m(a,b,e);c&&d("GET",l[a],c,e);return e};return e=new j.Object(c)},Controller:function(b){var e=q.typeOf;b="object"===e(b)?b:{};var c="string"===
e(b.appname)?b.appname:null;c&&"object"===e(j.Apps[c])?b.app=j.Apps[c]:"object"===e(j._)&&"object"===e(j._.defapp)&&(b.app=j._.defapp);b=new j.Object(b);"function"===e(b.init)&&b.init(b);return b},Data:function(b){var e,c=q.typeOf,a=q.merge,g={},h=!1,l=function(b,h){var f="string"===c(g.request)?g.request:null,l="object"===c(g.app.Api)?g.app.Api:null,k="string"===c(g.pushkey)?g.pushkey:null,j,s,p="object"===c(h)?h:{},q="string"===c(p.method)?p.method:null,r="object"===c(p.data)?p.data:null,v;!q&&
"push"===b?(q="post",v="Push",j="boolean"===c(p.update)?p.update:!1,s="boolean"===c(p.merge)?p.merge:!1):!q&&"pull"===b&&(q="get",v="Pull",j="boolean"===c(p.update)?p.update:!0,s="boolean"===c(p.merge)?p.merge:!0);null===r&&(r="object"===c(e.attributes)?e.attributes:{});p.data=r;f&&l&&(f=l[q](f,p),f.on("Success",function(b,d){r=k&&"undefined"!==c(d[k])?d[k]:d;!0===s&&(r=a(r,e.attributes));!0===j&&e.set(r);e.trigger(v+":Success",r)}),f.on("Error",function(a,b){e.trigger(v+":Error",b)}),f.on("Timeout",
function(a,b){e.trigger(v+":Timeout",b)}));return e},s="string"===c(b.appname)?b.appname:null;b="object"===c(b)?b:{};g=a(b,{attributes:{}});s&&"object"===c(j.Apps[s])?g.app=j.Apps[s]:"object"===c(j._)&&"object"===c(j._.defapp)&&(g.app=j._.defapp);g.id&&g.attributes&&!h&&(h=new j.Cache({size:1,id:g.id,localStorage:!0}),h.get()[0]!=={}||""!==h.get()[0]?g.attributes=h.get()[0]:h.add(g.attributes));g.set=function(a,b){if("object"===typeof a)e.attributes=a,e.trigger("Change",{newdata:a});else if("string"===
typeof a)"object"!==c(e.attributes)&&(e.attributes={}),e.attributes[a]=b,e.trigger("Change:"+a,{newdata:b});else return!1;var f="string"===c(g.id)?g.id:null;f&&(h||(h=new j.Cache({size:1,id:f,localStorage:!0})),h.add(e.attributes));return e};g.get=function(a){var b=e.attributes;return"string"===typeof a?b[a]:b};g.pull=function(a){return l("pull",a)};g.push=function(a){return l("push",a)};e=new j.Object(g);"function"===c(e.init)&&e.init(e);return e},Microtemplate:function(b){var e=/\{{([^}]+)\}}/g,
c={render:function(b){b="object"===typeof b?b:{};b="object"===typeof b.variables?b.variables:void 0;b="object"===typeof b?b:"object"===typeof a.arg.variables?a.arg.variables:null;var g,j,d,m;g=a.template;var f=document.createElement(a.elType);if(b&&"string"===typeof g){j=g.match(e);if(null!==j)for(var n=d=j.length;n--;)d=j[n],m=j[n].slice(2,j[n].length-2),g=g.replace(d,b[m]);a.rendered=g;f.innerHTML=g;a.el=$(g);c.onDone()}else"string"===typeof g&&(a.rendered=g,f.innerHTML=g,a.el=$(g),c.onDone());
return a},onDone:function(){"function"===typeof a.arg.render&&a.arg.render(a)},getT:function(b){"undefined"!==typeof("string"===typeof a.template?a.template:void 0)&&!1===b?("function"===typeof a.arg.loaded&&a.arg.loaded(a),"function"===typeof c.onDone&&c.render(a)):"string"===typeof a.url&&$.ajax({url:a.url+"?v="+a.version,async:!0,success:function(b){a.template=b;a.el=$(b);"function"===typeof a.arg.loaded&&a.arg.loaded(a);"function"===typeof c.onDone&&c.render(a.template)},error:function(){return null}})}},
a={elType:"div",arg:b,url:void 0,template:void 0,rendered:void 0,version:0,render:c.render},g="boolean"===typeof b.force?b.force:!1;a.arg=b;"string"===typeof b.html?(a.template=b.html,"function"===typeof b.loaded&&b.loaded(a),c.render()):"string"===typeof b.url&&(a.url=b.url,c.getT(g));a.version="number"===typeof b.version?b.version:"object"===typeof j._&&"object"===typeof j._.defapp&&"object"===typeof j._.defapp.config&&"object"===typeof j._.defapp.config.versions&&"number"===typeof j._.defapp.config.versions.templates?
j._.defapp.config.versions.templates:1;return a},View:function(b){return new function(){var e=new j.Object,c={},a,g,h=q.isElement,l=function(b){var h,f="object"===typeof b?b:{},j="function"===typeof f.onSuccess?f.onSuccess:function(){},k=function(a){if(d){d.html(a);for(var b in c)c.hasOwnProperty(b)&&(m[b]=d.find(c[b]))}e.elements=m};if(!0===g)h=a.render(b),e.template=h,k(h.el),j(e),e.trigger("TemplateRendered",e);else e.on("TemplateReady",function(a,b){h=b;e.template=h;k(h.el);j(e);(void 0).trigger("TemplateRendered",
e)});return e},s=function(a,b){var c="string"===typeof a?a:null,d="string"===typeof b||"number"===typeof b?b:"",g,f=null,j;c&&(c=c.split(":"),g=c[0],"string"===typeof c[1]&&(f=c[1]),"undefined"!==typeof m[g]&&h(m[g][0])?j=m[g]:"string"===g&&(j=$(g)),null===f?j.html(d):j.attr(f,d));return e},d=null,m={},f=j,n=f.Apps,k="object"===typeof b?b:{},u="string"===typeof k.html?k.html:null,t="string"===typeof k.url?k.url:null,p="string"===typeof k.storageID?k.storageID:null,w="boolean"===typeof k.appstorage?
k.appstorage:!0,r="string"===typeof k.appname?k.appname:null;g=!1;!0===w&&p&&(!r&&"object"===typeof f._.defapp&&(r=f._.defapp.name),r&&("object"===typeof n&&"object"===typeof n[r])&&(f=n[r],f._.getTemplate(p,{url:t,html:u,loaded:function(b){a=b;g=!0;e.trigger("TemplateReady",a)}})));c="object"===typeof k.elements?k.elements:{};return function(a){a="object"===typeof a?a:{};d="object"===typeof a.el&&h(a.el[0])?a.el:"string"===typeof a.el?$(a.el):null;e.el=d;e.render=l;e.update=s;e.elements=m;e.events=
void 0;return e}}},App:function(b){var e=new j.Object,c=q,a=c.typeOf,g=j.Microtemplate,c=c.isElement,h={Router:{Default:""}},l={},s={},d=function(a,b,e){var c="object"===typeof l.Templates.get()[0]?l.Templates.get()[0]:!1,d=h.versions.templates;if(!c||"object"!==typeof c.templates)c={templates:{}},c.version=d;c.templates[a]={version:e,html:b};l.Templates.add(c)},m="object"===a(b)?b:{};b="string"===a(m.name)?m.name:Math.random().toString(36).substring(7);var c="object"===a(m.el)&&c(m.el[0])?m.el:$("body"),
f="boolean"===typeof m.localStorage?m.localStorage:!1,n="object"===typeof m.versions?m.versions:{},k=b+"_templates",u=b+"_data";n.templates="number"===typeof n.templates?n.templates:1;n.data="number"===typeof n.data?n.data:1;if(m)for(var t in m)m.hasOwnProperty(t)&&(h[t]=m[t]);h.versions=n;l.Templates=new j.Cache({size:1,id:k,localStorage:f});l.Data=new j.Cache({size:1,id:u,localStorage:f});j._.defapp=e;j.Apps[b]=e;t=h.Router;var m={},p,w={},r,v=/\{([^}]+)\}/g;if("object"===typeof t){for(var x in t)if(t.hasOwnProperty(x)){f=
x;k=f.split("/");""===k[0]&&k.splice(0,1);""===k[k.length-1]&&(k=k.splice(k.length-1,1));u=k.length;p=f.match(v);n=[];if(p)for(var y=r=0;y<u;y++)p=k[y].match(v)?k[y]:void 0,void 0!==p?(p=p.substr(1,p.length-2),n.push(p),w[p]=void 0,r++):n.push(void 0);m[x]={event:t[x],route:f,len:u,split:k,variables:n,varkeys:w}}s=m}e.el=c;e.name=b;e.start=function(){e.trigger("Starting");var b=function(a){var b=a.substr(1,a.length-1),c;if(""===a)c={key:"Default",variables:{}};else a:{a=s;var b=b.split("/"),d=!1,
g={},h;""===b[0]&&b.splice(0,1);""===b[b.length-1]&&(b=b.splice(0,b.length-1));h=b.length;for(c in a)if(a.hasOwnProperty(c)){if(h===a[c].len){for(var d=!0,f=0;f<h;f++)b[f].toLowerCase()!==a[c].split[f].toLowerCase()&&(d=!1);if(!1===d)for(f=0;f<h;f++)b[f].toLowerCase()===a[c].split[f].toLowerCase()||void 0!==a[c].variables[f]?(void 0!==a[c].variables[f]&&(g[a[c].variables[f]]=b[f]),d=!0):d=!1}if(!0===d){c={key:a[c].event,variables:g};break a}}c=!1}e.trigger("Router:BeforeRouter");e.trigger("Router:"+
c.key,c.variables)};if("onhashchange"in window)window.onhashchange=function(){b(window.location.hash)};else{var c=window.location.hash,d;window.setInterval(function(){window.location.hash!=c&&(d=window.location.hash,b(d))},100)}b(window.location.hash);e.on("a:click",function(b,c){var d;d=c.url;d="string"===a(d)?d:null;var e="";d?("#"!==d.charAt(0)&&"/"!==d.charAt(0)?e="#/"+d:"/"===d.charAt(0)?e="#"+d:"#"===d.charAt(0)&&"/"!==d.charAt(1)?(e=d.substring(d.length,2),e="#/"+e):e=d,d=e):d=null;e=c.el;
d&&"false"!==e.attr("data-coreroute")&&(window.location=d)});return e};e.config=h;h.Api&&(e.Api=new j.Api(h.Api));"boolean"!==a(h.routerOverrideLinks)&&(h.routerOverrideLinks=!0);e._={saveTemplate:d,getTemplate:function(a,b){var c="object"===typeof b?b:{},e="object"===typeof l.Templates.get()[0]?l.Templates.get()[0]:!1,f=h.versions.templates,j="number"===typeof c.version?c.version:1,k="function"===typeof b.loaded?b.loaded:!1,c=!0;if(e)if("number"===typeof e.version&&e.version===f){if("object"===typeof e.templates&&
"object"===typeof e.templates[a]){c=!1;var e=e.templates[a],f="string"===typeof e.html?e.html:"...",m="function"===typeof b.loaded?b.loaded:!1;("number"===typeof e.version?e.version:1)===j?(b.url=null,b.html=f):b.loaded=function(b){d(a,b.template,j);m&&m(b)};e=new g(b);return e}}else l.Templates.resetCache();if(!0===c)return b.loaded=function(b){d(a,b.template,j);k&&k(b)},new g(b,!0)},saveData:function(){},getData:function(){}};if(!0===h.routerOverrideLinks)c.on("click",function(a){var b=a.target,
c=$(b),d=/(https?:\/\/[^\s]+)/g,f="";if("a"===b.nodeName||"A"===b.nodeName)f=c.attr("href"),f.match(d)?1===f.match(d).length&&(window.location=f):(a.preventDefault(),e.trigger("a:click",{el:c,url:f}))});return e},version:"0.2.5"};"function"===typeof define&&define.amd?define("Core",[],function(){return j}):"undefined"!==typeof module&&"undefined"!==typeof exports&&module.exports?module.exports=j:A["string"===typeof z?z:"Core"]=j})(this,"$$");
