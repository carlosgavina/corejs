/* core.js v0.2.3 by @carlosgavina | hello@carlosgavina.com | https://github.com/carlosgavina/corejs */
(function(y,w){var t={typeOf:function(b){var c=typeof b;"object"===c&&null===b&&(null===b?c="null":"number"===typeof b.length&&(c="array"));return c},merge:function(b,c){var d={},a="object"===t.typeOf(b)?b:null,f="object"===t.typeOf(c)?c:null,j;if(a)for(j in a)d[j]=a[j];if(f)for(j in f)d[j]=f[j];return d}},h={_:{},Apps:{},Tools:t,Object:function(b){var c=this,d=t.typeOf,a=document.createElement("p"),f={_:{_:$(a)}},j=function(a,c,e){var b;c="string"===d(c)?c:"_";e="boolean"===d(e)?e:!0;if("string"===
d(a)){b=a.split(":");1===b.length?(a="_",b=b[0]):(a=b[0],b=b[1]);if("object"!==d(f[a])&&!0===e)f[a]={};else if("object"!==d(f[a]))return;if("object"!==d(f[a][c])&&!0===e)f[a][c]=$(document.createElement("p"));else if("object"!==d(f[a][c]))return;return{context:c,name:b,hub:f[a],event:f[a][c]}}};this._={};this._.clone=function(){Object.create||function(a){function c(){}c.prototype=a;return new c}};this._.implement=function(a){if(a)for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);return c};instance=
this._.clone(this);b&&this._.implement.call(instance,b);this.on=function(a,b,e){b="function"===typeof b?b:void 0;a=j(a,e);if("object"===d(a)&&"function"===d(b))a.event.on(a.name,$.proxy(b,c));return c};this.trigger=function(a,b,e){var f="string"===d(e)?e:"all";a=j(a,e,!1);if("object"===d(a))if("all"===f)for(var g in a.hub)a.hub[g].trigger(a.name,b);else a.event.trigger(a.name,b);return c};this.off=function(a,b){var e="string"===d(b)?b:"all",p=j(a,b,!1),g,k;if(void 0!==p)if(g=a.split(":"),g=1===g.length?
null:p.name,"all"===e)for(k in p.hub)p.hub[k].off(g);else p.event.off(g);else for(k in f)for(g in f[k])f[k][g].off();return c};return instance},Cache:function(b){var c={},d={},a={history:[],size:10,localStorage:!1,id:null},f=function(){var e;if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&"undefined"!==typeof localStorage)try{e=JSON.stringify(a.history),localStorage.setItem(a.id,e),c.trigger("LocalStorage:Save",{id:a.id,data:a.history})}catch(b){}};
if("object"===typeof b)for(var j in b)a[j]=b[j];var m;if("boolean"===typeof a.localStorage&&("string"===typeof a.id&&!0===a.localStorage&&0<a.id.length)&&"undefined"!==typeof localStorage)try{m=JSON.parse(localStorage.getItem(a.id)),"object"===typeof m&&void 0!==m.length&&(a.history=m)}catch(r){}d={add:function(e){var b=a.history.length,d=a.size;"undefined"!==typeof e&&("object"==typeof e&&e.length?(a.history=a.history.concat(e),b=a.history.length,b>=d&&a.history.splice(0,b-d)):(b>=d&&a.history.shift(),
a.history.push(e)));f();return c},get:function(){return a.history},remove:function(c){var b=a.history,d=a.history.length,j=!1;if("undefined"!==typeof c)for(;d--;)if(b[d]===c){a.history.splice(d,1);j=!0;break}f();return j},exists:function(c){var b=a.history,d=a.history.length;if("undefined"!==typeof c)for(;d--;)if(b[d]===c)return d;return!1},addUnique:function(b){var d=a.history,j=a.history.length;if("undefined"!==typeof b)for(;j--;)if(d[j]===b){a.history.splice(j,1);break}a.history.push(b);f();return c},
setMaxSize:function(b){a.size="number"===typeof b?b:detaults.size;return c},resetCache:function(){a.history=[];f()},removeAtIndex:function(c){if("number"===typeof c)return c<a.history.length?(a.history.splice(c,1),!0):!1;f()},setLocalStorage:function(c){a.localStorage="boolean"===typeof c?c:a.localStorage}};return c=new h.Object(d)},Api:function(b){var c,d={},a=t.typeOf,f=t.merge,j={protocol:"http://",timeout:1E4,async:!0},m={},r={},e=function(a,b,d,e){d.success=function(a){e.trigger("Success",a);
c.trigger("Success",a)};d.error=function(a,b){var d={error:{id:2,description:b,response:a.response,xhr:a}},f="Error";if("timeout"===b||"Timeout"===b)f="Timeout";e.trigger(f,d);c.trigger(f,d)};d.type=a;d.url=d.protocol+r.url+b.endpoint;a=$.ajax(d);e.request=a;return e},p=function(b,d,e){var g=null,k="Unknown";"string"===a(b)&&"object"===a(m[b])?(b="object"===a(m[b].options)?m[b].options:null,g=f(j,b),g=f(g,d)):("string"===a(b)&&(k=b),e.trigger("Error",{error:{id:1,description:"Request '"+k+"' doesn't exist."}}),
c.trigger("Error",{error:{id:1,description:"Request '"+k+"' doesn't exist."}}));return g},g;for(g in b)if("requests"!==g&&"url"!==g)j[g]=b[g];else if("requests"===g){var k=b[g];if("object"===a(k)){var l=void 0;for(l in k){var v=l,s=k[l];"string"===a(s.endpoint)&&(m[v]=s)}}else"string"===a(k)&&"string"===a(void 0)&&"string"===a((void 0).endpoint)&&(m[k]=void 0)}else"url"===g&&(r[g]=b[g]);d.post=function(a,b){var c=new h.Object,d=p(a,b,c);d&&e("POST",m[a],d,c);return c};d.get=function(a,b){var c=new h.Object,
d=p(a,b,c);d&&e("GET",m[a],d,c);return c};return c=new h.Object(d)},Controller:function(b){var c=t.typeOf;b="object"===c(b)?b:{};var d="string"===c(b.appname)?b.appname:null;d&&"object"===c(h.Apps[d])?b.app=h.Apps[d]:"object"===c(h._)&&"object"===c(h._.defapp)&&(b.app=h._.defapp);b=new h.Object(b);"function"===c(b.init)&&b.init(b);return b},Data:function(b){var c,d=t.typeOf,a=t.merge,f={},j=!1,m=function(b,j){var g="string"===d(f.request)?f.request:null,k="object"===d(f.app.Api)?f.app.Api:null,m=
"string"===d(f.pushkey)?f.pushkey:null,h,r,n="object"===d(j)?j:{},u="string"===d(n.method)?n.method:null,q="object"===d(n.data)?n.data:null;!u&&"push"===b?(u="post",q||(q="object"===d(f.attributes)?f.attributes:{}),h="boolean"===d(n.update)?n.update:!1,r="boolean"===d(n.merge)?n.merge:!1):!u&&"pull"===b&&(u="get",h="boolean"===d(n.update)?n.update:!0,r="boolean"===d(n.merge)?n.merge:!0);n.data=q;g&&k&&(request=k[u](g,n),request.on("Success",function(f,j){q=m&&"undefined"!==d(j[m])?j[m]:j;!0===r&&
(q=a(q,c.attributes));!0===h&&c.set(q);c.trigger(b+":Success",q)}),request.on("Error",function(a,d){c.trigger(b+":Error",d)}),request.on("Timeout",function(a,d){c.trigger(b+":Timeout",d)}));return c},r="string"===d(b.appname)?b.appname:null;b="object"===d(b)?b:{};f=a(b,{attributes:{}});r&&"object"===d(h.Apps[r])?f.app=h.Apps[r]:"object"===d(h._)&&"object"===d(h._.defapp)&&(f.app=h._.defapp);f.id&&f.attributes&&!j&&(j=new h.Cache({size:1,id:f.id,localStorage:!0}),j.get()[0]!=={}||""!==j.get()[0]?f.attributes=
j.get()[0]:j.add(f.attributes));f.set=function(a,b){if("object"===typeof a)c.attributes=a,c.trigger("Change",{newdata:a});else if("string"===typeof a)"object"!==d(c.attributes)&&(c.attributes={}),c.attributes[a]=b,c.trigger("Change:"+a,{newdata:b});else return!1;var g="string"===d(f.id)?f.id:null;g&&(j||(j=new h.Cache({size:1,id:g,localStorage:!0})),j.add(c.attributes));return c};f.get=function(a){var b=c.attributes;return"string"===typeof a?b[a]:b};f.pull=function(a){return m("pull",a)};f.push=function(a){return m("push",
a)};c=new h.Object(f);"function"===d(c.init)&&c.init(c);return c},Microtemplate:function(b){var c=/\{{([^}]+)\}}/g,d={render:function(b){b="object"===typeof b?b:{};b="object"===typeof b.variables?b.variables:void 0;b="object"===typeof b?b:"object"===typeof a.arg.variables?a.arg.variables:null;var f,h,e,p;f=a.template;var g=document.createElement(a.elType);if(b&&"string"===typeof f){h=f.match(c);if(null!==h)for(var k=e=h.length;k--;)e=h[k],p=h[k].slice(2,h[k].length-2),f=f.replace(e,b[p]);a.rendered=
f;g.innerHTML=f;a.el=$(f);d.onDone()}else"string"===typeof f&&(a.rendered=f,g.innerHTML=f,a.el=$(f),d.onDone());return a},onDone:function(){"function"===typeof a.arg.render&&a.arg.render(a)},getT:function(b){"undefined"!==typeof("string"===typeof a.template?a.template:void 0)&&!1===b?("function"===typeof a.arg.loaded&&a.arg.loaded(a),"function"===typeof d.onDone&&d.render(a)):"string"===typeof a.url&&$.ajax({url:a.url+"?v="+a.version,async:!0,success:function(b){a.template=b;a.el=$(b);"function"===
typeof a.arg.loaded&&a.arg.loaded(a);"function"===typeof d.onDone&&d.render(a.template)},error:function(){return null}})}},a={elType:"div",arg:b,url:void 0,template:void 0,rendered:void 0,version:0,render:d.render},f="boolean"===typeof b.force?b.force:!1;a.arg=b;"string"===typeof b.html?(a.template=b.html,"function"===typeof b.loaded&&b.loaded(a),d.render()):"string"===typeof b.url&&(a.url=b.url,d.getT(f));a.version="number"===typeof b.version?b.version:"object"===typeof h._&&"object"===typeof h._.defapp&&
"object"===typeof h._.defapp.config&&"object"===typeof h._.defapp.config.versions&&"number"===typeof h._.defapp.config.versions.templates?h._.defapp.config.versions.templates:1;return a},View:function(b){return new function(){var c=new h.Object,d={},a,f,j=function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===typeof a.ownerDocument}},m=function(b){var g,j="object"===typeof b?b:{},h="function"===typeof j.onSuccess?j.onSuccess:
function(){};gatherElements=function(a){if(e){e.html(a);for(var b in d)p[b]=e.find(d[b])}c.elements=p};if(!0===f)g=a.render(b),c.template=g,gatherElements(g.el),h(c),c.trigger("TemplateRendered",c);else c.on("TemplateReady",function(a,b){g=b;c.template=g;gatherElements(g.el);h(c);(void 0).trigger("TemplateRendered",c)});return c},r=function(a,b){var d="string"===typeof a?a:null,f="string"===typeof b||"number"===typeof b?b:"",e,g=null,h;d&&(d=d.split(":"),e=d[0],"string"===typeof d[1]&&(g=d[1]),"undefined"!==
typeof p[e]&&j(p[e][0])?h=p[e]:"string"===e&&(h=$(e)),null===g?h.html(f):h.attr(g,f));return c},e=null,p={},g=h,k=g.Apps,l="object"===typeof b?b:{},v="string"===typeof l.html?l.html:null,s="string"===typeof l.url?l.url:null,n="string"===typeof l.storageID?l.storageID:null,u="boolean"===typeof l.appstorage?l.appstorage:!0,q="string"===typeof l.appname?l.appname:null;f=!1;!0===u&&n&&(!q&&"object"===typeof g._.defapp&&(q=g._.defapp.name),q&&("object"===typeof k&&"object"===typeof k[q])&&(g=k[q],g._.getTemplate(n,
{url:s,html:v,loaded:function(b){a=b;f=!0;c.trigger("TemplateReady",a)}})));d="object"===typeof l.elements?l.elements:{};return function(a){a="object"===typeof a?a:{};e="object"===typeof a.el&&j(a.el[0])?a.el:"string"===typeof a.el?$(a.el):null;c.el=e;c.render=m;c.update=r;c.elements=p;c.events=void 0;return c}}},App:function(b){var c=new h.Object,d={Router:{Default:""}},a={},f={},j=h.Microtemplate,m=function(b,c,f){var e="object"===typeof a.Templates.get()[0]?a.Templates.get()[0]:!1,g=d.versions.templates;
if(!e||"object"!==typeof e.templates)e={templates:{}},e.version=g;e.templates[b]={version:f,html:c};a.Templates.add(e)},r=function(a){var b=f;a=a.split("/");var c=!1,d={};""===a[0]&&a.splice(0,1);""===a[a.length-1]&&(a=a.splice(a.length-1,1));request_split_len=a.length;for(var e in b){if(request_split_len===b[e].len){for(var c=!0,g=0;g<request_split_len;g++)a[g].toLowerCase()!==b[e].split[g].toLowerCase()&&(c=!1);if(!1===c)for(g=0;g<request_split_len;g++)a[g].toLowerCase()===b[e].split[g].toLowerCase()||
void 0!==b[e].variables[g]?(void 0!==b[e].variables[g]&&(d[b[e].variables[g]]=a[g]),c=!0):c=!1}if(!0===c)return{key:e,variables:d}}return!1},e="object"===typeof b?b:{};b="string"===typeof e.name?e.name:Math.random().toString(36).substring(7);var p="undefined"!==typeof e.el&&isElement(e.el[0])?e.el:$("body"),g="boolean"===typeof e.localStorage?e.localStorage:!1,k="object"===typeof e.versions?e.versions:{},l=b+"_data";k.templates="number"===typeof k.templates?k.templates:1;k.data="number"===typeof k.data?
k.data:1;if(e)for(var v in e)d[v]=e[v];d.versions=k;a.Templates=new h.Cache({size:1,id:b+"_templates",localStorage:g});a.Data=new h.Cache({size:1,id:l,localStorage:g});h._.defapp=c;h.Apps[b]=c;v=d.Router;var e={},s,n,u={},q,t=/\{([^}]+)\}/g;if("object"===typeof v){for(var w in v){g=v[w];l=g.split("/");""===l[0]&&l.splice(0,1);""===l[l.length-1]&&(l=l.splice(l.length-1,1));n=l.length;s=g.match(t);k=[];if(s)for(var x=q=0;x<n;x++)s=l[x].match(t)?l[x]:void 0,void 0!==s?(s=s.substr(1,s.length-2),k.push(s),
u[s]=void 0,q++):k.push(void 0);e[w]={route:g,len:n,split:l,variables:k,varkeys:u}}f=e}c.el=p;c.name=b;c.services={};c.start=function(){var a=function(a){var b=a.substr(1,a.length-1);a=""===a?{key:"Default",variables:{}}:r(b);c.trigger("Router:"+a.key,{variables:a.variables,self:c})};if("onhashchange"in window)window.onhashchange=function(){a(window.location.hash)};else{var b=window.location.hash,d;window.setInterval(function(){window.location.hash!=b&&(d=window.location.hash,a(d))},100)}a(window.location.hash);
return c};c.config=d;c.translateRoute=r;d.Api&&(c.Api=new $$.Api(d.Api));c.Data="object"===typeof d.Data?d.Data:{};c.Views="object"===typeof d.Views?d.Views:{};c._={saveTemplate:m,getTemplate:function(b,c){var f="object"===typeof c?c:{},e="object"===typeof a.Templates.get()[0]?a.Templates.get()[0]:!1,g=d.versions.templates,h="number"===typeof f.version?f.version:1,k="function"===typeof c.loaded?c.loaded:!1,f=!0;if(e)if("number"===typeof e.version&&e.version===g){if("object"===typeof e.templates&&
"object"===typeof e.templates[b]){f=!1;var e=e.templates[b],g="string"===typeof e.html?e.html:"...",l="function"===typeof c.loaded?c.loaded:!1;("number"===typeof e.version?e.version:1)===h?(c.url=null,c.html=g):c.loaded=function(a){m(b,a.template,h);l&&l(a)};e=new j(c);return e}}else a.Templates.resetCache();if(!0===f)return c.loaded=function(a){m(b,a.template,h);k&&k(a)},new j(c,!0)},saveData:function(){},getData:function(){}};return c}};"function"===typeof define&&define.amd?define("Core",[],function(){return h}):
"undefined"!==typeof module&&"undefined"!==typeof exports&&module.exports?module.exports=h:y["string"===typeof w?w:"Core"]=h})(this,"$$");

