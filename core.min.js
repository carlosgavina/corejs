/* core.js v0.2.8c by @carlosgavina | hello@carlosgavina.com | https://github.com/carlosgavina/corejs */
(function(y,t){var r={typeOf:function(a){var b=typeof a;"object"===b&&null===a&&(null===a?b="null":"number"===typeof a.length&&(b="array"));return b},merge:function(a,b){var c={},d="object"===r.typeOf(a)?a:null,e="object"===r.typeOf(b)?b:null,h;if(d)for(h in d)d.hasOwnProperty(h)&&(c[h]=d[h]);if(e)for(h in e)e.hasOwnProperty(h)&&(c[h]=e[h]);return c},isElement:function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===
typeof a.ownerDocument}},musthashRender:function(a,b){var c=/\{{([^}]+)\}}/g,d=r.typeOf,e=a,h;if("object"===d(b)&&(c=e.match(c),null!==c))for(var j=d=c.length;j--;)d=c[j],h=c[j].slice(2,c[j].length-2),e=e.replace(d,b[h]);return e},appChooser:function(a){var b=r.typeOf,c=m,d=c._,c=c.Apps;a="string"===b(a)?a:null;var e=null;!a&&"object"===b(d.defapp)&&(a=d.defapp.name);a&&("object"===b(c)&&"object"===b(c[a]))&&(e=c[a]);return e}},m={_:{},Apps:{},Tools:r,Object:function(a){var b=this,c=r.typeOf,d;d=
document.createElement("p");var e={_:{_:$(d)}},h={},j=function(b,g,d){var f;g="string"===c(g)?g:"_";d="boolean"===c(d)?d:!0;if("string"===c(b)){f=b.split(":");1===f.length?(b="_",f=f[0]):(b=f[0],f=f[1]);if("object"!==c(e[b])&&!0===d)e[b]={};else if("object"!==c(e[b]))return;if("object"!==c(e[b][g])&&!0===d)e[b][g]=$(document.createElement("p"));else if("object"!==c(e[b][g]))return;return{context:g,name:f,hub:e[b],event:e[b][g]}}};this._={};this._.clone=function(){Object.create||function(b){function c(){}
c.prototype=b;return new c}};this._.implement=function(c){if(c)for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);return b};d=this._.clone(this);a&&this._.implement.call(d,a);this.on=function(d,g,e){g="function"===typeof g?g:void 0;d=j(d,e);if("object"===c(d)&&"function"===c(g))d.event.on(d.name,$.proxy(g,b));return b};this.trigger=function(d,e,a){var f="string"===c(a)?a:"all";d=j(d,a,!1);if("object"===c(d))if("all"===f){var f=d.hub,l;for(l in f)f.hasOwnProperty(l)&&f[l].trigger(d.name,e)}else d.event.trigger(d.name,
e);return b};this.off=function(d,a){var n="string"===c(a)?a:"all",f=j(d,a,!1),l,h;if(void 0!==f)if(l=d.split(":"),l=1===l.length?null:f.name,"all"===n)for(h in n=f.hub,n)n.hasOwnProperty(h)&&n[h].off(l);else f.event.off(l);else for(h in e)if(e.hasOwnProperty(h))for(l in e[h])e[h].hasOwnProperty(l)&&e[h][l].off();return b};this.close=function(d){var a="object"===c(d)?d:{};d="boolean"===c(a.clearData)?a.clearData:!0;a="boolean"===c(a.closeData)?a.closeData:!0;b.trigger("Before:Close");if(!0===a){var a=
h,e;for(e in a)if("object"===c(a[e]))if("function"===c(a[e].close))a[e].close();else for(var f in a[e])"object"===c(a[e][f])&&"function"===c(a[e][f].close)&&a[e][f].close()}!0===d&&b.data(null);b.off()};this.data=function(d,a){if("object"!==c(a)&&"string"===c(d))return h[d];if("string"===c(d))h[d]=a;else if(null===d)h={};else if("undefined"===c(d))return h;return b};return d},Cache:function(a){var b={},c={},d={history:[],size:10,localStorage:!1,id:null},e=function(){var a;if("boolean"===typeof d.localStorage&&
("string"===typeof d.id&&!0===d.localStorage&&0<d.id.length)&&"undefined"!==typeof localStorage)try{a=JSON.stringify(d.history),localStorage.setItem(d.id,a),b.trigger("LocalStorage:Save",{id:d.id,data:d.history})}catch(c){}};if("object"===typeof a)for(var h in a)a.hasOwnProperty(h)&&(d[h]=a[h]);var j;if("boolean"===typeof d.localStorage&&("string"===typeof d.id&&!0===d.localStorage&&0<d.id.length)&&"undefined"!==typeof localStorage)try{j=JSON.parse(localStorage.getItem(d.id)),"object"===typeof j&&
void 0!==j.length&&(d.history=j)}catch(k){}c={add:function(a){var c=d.history.length,f=d.size;"undefined"!==typeof a&&("object"==typeof a&&a.length?(d.history=d.history.concat(a),c=d.history.length,c>=f&&d.history.splice(0,c-f)):(c>=f&&d.history.shift(),d.history.push(a)));e();return b},get:function(){return d.history},remove:function(b){var a=d.history,c=d.history.length,l=!1;if("undefined"!==typeof b)for(;c--;)if(a[c]===b){d.history.splice(c,1);l=!0;break}e();return l},exists:function(b){var a=
d.history,c=d.history.length;if("undefined"!==typeof b)for(;c--;)if(a[c]===b)return c;return!1},addUnique:function(a){var c=d.history,f=d.history.length;if("undefined"!==typeof a)for(;f--;)if(c[f]===a){d.history.splice(f,1);break}d.history.push(a);e();return b},setMaxSize:function(a){d.size="number"===typeof a?a:10;return b},resetCache:function(){d.history=[];e()},removeAtIndex:function(b){if("number"===typeof b)return b<d.history.length?(d.history.splice(b,1),!0):!1;e()},setLocalStorage:function(b){d.localStorage=
"boolean"===typeof b?b:d.localStorage}};return b=new m.Object(c)},Api:function(a){var b,c={},d=r.typeOf,e=r.merge,h={protocol:"http://",timeout:1E4,async:!0},j={},k={},g=function(a,d,c,e){c.success=function(a){e.trigger("Success",a);b.trigger("Success",a)};c.error=function(a,c){var d={error:{id:2,description:c,response:a.response,xhr:a}},f="Error";if("timeout"===c||"Timeout"===c)f="Timeout";e.trigger(f,d);b.trigger(f,d)};c.type=a;c.url=c.protocol+k.url+d.endpoint;a=$.ajax(c);e.request=a;return e},
n=function(a,c,f){var l=null,s="Unknown";"string"===d(a)&&"object"===d(j[a])?(a="object"===d(j[a].options)?j[a].options:null,l=e(h,a),l=e(l,c)):("string"===d(a)&&(s=a),f.trigger("Error",{error:{id:1,description:"Request '"+s+"' doesn't exist."}}),b.trigger("Error",{error:{id:1,description:"Request '"+s+"' doesn't exist."}}));return l},f;for(f in a)if("requests"!==f&&"url"!==f)h[f]=a[f];else if("requests"===f){var l=a[f];if("object"===d(l)){var q=void 0;for(q in l)if(l.hasOwnProperty(q)){var p=q,s=
l[q];"string"===d(s.endpoint)&&(j[p]=s)}}else"string"===d(l)&&"string"===d(void 0)&&"string"===d((void 0).endpoint)&&(j[l]=void 0)}else"url"===f&&(k[f]=a[f]);c.post=function(a,b){var c=new m.Object,d=n(a,b,c);d&&g("POST",j[a],d,c);return c};c.get=function(a,b){var c=new m.Object,d=n(a,b,c);d&&g("GET",j[a],d,c);return c};return b=new m.Object(c)},Controller:function(a){var b=r.typeOf;a="object"===b(a)?a:{};var c="string"===b(a.appname)?a.appname:null;c&&"object"===b(m.Apps[c])?a.app=m.Apps[c]:"object"===
b(m._)&&"object"===b(m._.defapp)&&(a.app=m._.defapp);a=new m.Object(a);"function"===b(a.init)&&a.init(a);return a},Data:function(a){var b,c=r.typeOf,d=r.merge,e={},h=!1,j=!1,k=function(a,f){var l="string"===c(e.request)?e.request:null,h="object"===c(e.app.Api)?e.app.Api:null,p="string"===c(e.pushkey)?e.pushkey:null,s,j,g="object"===c(f)?f:{},m="string"===c(g.method)?g.method:null,k="object"===c(g.data)?g.data:null,u;!m&&"push"===a?(m="post",u="Push",s="boolean"===c(g.update)?g.update:!1,j="boolean"===
c(g.merge)?g.merge:!1):!m&&"pull"===a&&(m="get",u="Pull",s="boolean"===c(g.update)?g.update:!0,j="boolean"===c(g.merge)?g.merge:!0);null===k&&(k="object"===c(b.attributes)?b.attributes:{});g.data=k;l&&h&&(l=h[m](l,g),l.on("Success",function(a,e){k=p&&"undefined"!==c(e[p])?e[p]:e;!0===j&&(k=d(k,b.attributes));!0===s&&(b.set(k),b.trigger("Data:Available",k));b.trigger(u+":Success",k)}),l.on("Error",function(a,c){b.trigger(u+":Error",c)}),l.on("Timeout",function(a,c){b.trigger(u+":Timeout",c)}));return b},
g="string"===c(a.appname)?a.appname:null;a="object"===c(a)?a:{};e=d(a,{attributes:{}});g&&"object"===c(m.Apps[g])?e.app=m.Apps[g]:"object"===c(m._)&&"object"===c(m._.defapp)&&(e.app=m._.defapp);e.id&&e.attributes&&!j&&(j=new m.Cache({size:1,id:e.id,localStorage:!0}),j.get()[0]!=={}||""!==j.get()[0]?e.attributes=j.get()[0]:j.add(e.attributes),h=!0);e.set=function(a,d){if("object"===typeof a)b.attributes=a,b.trigger("Change",{newdata:a});else if("string"===typeof a)"object"!==c(b.attributes)&&(b.attributes=
{}),b.attributes[a]=d,b.trigger("Change:"+a,{newdata:d});else return!1;var l="string"===c(e.id)?e.id:null;l&&(j||(j=new m.Cache({size:1,id:l,localStorage:!0})),j.add(b.attributes));return b};e.get=function(a){var d=b.attributes;return"string"===c(a)&&"object"===c(b.attributes)?d[a]:d};e.pull=function(a){return k("pull",a)};e.push=function(a){return k("push",a)};b=new m.Object(e);!0===h&&("undefined"!==c(b.attributes)&&b.attributes!=={})&&b.trigger("Data:Available",b.attributes);"function"===c(b.init)&&
b.init(b);return b},Microtemplate:function(a){var b,c=!1,d=r,e=d.typeOf,h=d.isElement,j=d.appChooser,k=d.musthashRender,g,n=function(a){a="object"===e(a)?a:{};var d="object"===e(a.variables)?a.variables:null,f=h(a.el[0])?a.el:null,l=function(a){b.result=k(a,d);b.el=$(b.result);f&&f.html(b.el);b.trigger("Rendered")};if(!0===c)l(b.html);else b.on("Ready",function(){l(b.html)})},f=function(a,d){var f="boolean"===e(d)?d:!1;void 0!==b?b.html=a:l.html=a;c=!0;!0===f&&q()},l={config:{version:1,use_app_storage:!0},
html:"",render:n,result:"",el:void 0},q=function(a){a="object"===e(a)?a:null;var c,d,f;d=a=void 0!==b?b.config:l.config;"string"===e(a.id)&&(!0===a.use_app_storage?(c=j(a.appname))&&(f=c._.getTemplate(a.id)):(g=new m.Cache({size:1,id:a.id,localStorage:!0}),f=g.get()[0]),void 0===f?!0===a.use_app_storage?c._.saveTemplate(a.id,a):g.add(a):f.version!==a.version?(!0===a.use_app_storage?c._.saveTemplate(a.id,a):g.add(a),d=a):d=f);return d},d=e(a)?a:{};a={};for(var p in d)d.hasOwnProperty(p)&&(l.config[p]=
d[p]);a=q();"string"===e(a.html)?f(a.html):"string"===e(a.url)?(p={},p.url=a.url+"?v"+a.version,p.success=function(a){f(a,!0);b.trigger("Ready")},p.error=function(a){b.trigger("Error",{error:a})},$.ajax(p)):"object"===e(a.el)&&h(a.el[0])&&f(a.el.html());b=new m.Object(l);!0===c&&b.trigger("Ready");"function"===e(b.init)&&b.init(b);b.on("Render",function(a,c){n(c)});return b},View:function(a){var b=r,c=b.typeOf,d=b.isElement,e,b={elements:{}},h={},j=function(a,b){var g=d(a[0])?a:e.template.el,j="object"===
c(b)?b:"object"===c(h.elements)?h.elements:null;if(j)for(var k in j)j.hasOwnProperty(k)&&(e.elements[k]=g.find(j[k]))},k=function(a){var b=e.template,h="object"===c(a)?a:{},k="object"===c(h.el)&&d(h.el[0])?h.el:null;b&&(b.off("Rendered","thisview"),b.on("Rendered",function(){k&&(k.html(this.el),j(k));e.update=g;e.trigger("Template:Rendered")},"thisview"),b.render(a));return e},g=function(a,b){var h="object"===c(e.elements)?e.elements:null,g="string"===typeof a?a:null,j="string"===typeof b||"number"===
typeof b?b:"",k,m;h&&g&&(g=g.split(":"),a=g[0],"string"===typeof g[1]&&(k=g[1]),"undefined"!==typeof h[a]&&d(h[a][0])?m=h[a]:"string"===a&&(m=$(a)),"object"===c(m)&&d(m[0])&&(null===k||void 0===k?m.html(j):m.attr(k,j)));return e};a=c(a)?a:{};for(var n in a)a.hasOwnProperty(n)&&("template"===n||"elements"===n?h[n]=a[n]:b[n]=a[n]);b.template="object"===c(h.template)&&"function"===c(h.template.render)?h.template:null;b.render=k;b.gatherElements=j;e=new m.Object(b);"function"===c(e.init)&&e.init(e);e.on("Render",
function(a,b){k(b)});return e},App:function(a){var b=new m.Object,c=r,d=c.typeOf,e=c.isElement,c={Router:{Default:""}},h,j={},k="object"===d(a)?a:{};a="string"===d(k.name)?k.name:Math.random().toString(36).substring(7);var e="object"===d(k.el)&&e(k.el[0])?k.el:$("body"),g="boolean"===typeof k.localStorage?k.localStorage:!0,n="object"===typeof k.versions?k.versions:{},f=a+"_templates",l=a+"_data";n.templates="number"===typeof n.templates?n.templates:1;n.data="number"===typeof n.data?n.data:1;if(k)for(var q in k)k.hasOwnProperty(q)&&
(c[q]=k[q]);c.versions=n;h=new m.Cache({size:1,id:f,localStorage:g});new m.Cache({size:1,id:l,localStorage:g});m._.defapp=b;m.Apps[a]=b;q=c.Router;var k={},p,s={},t,x=/\{([^}]+)\}/g;if("object"===typeof q){for(var v in q)if(q.hasOwnProperty(v)){g=v;f=g.split("/");""===f[0]&&f.splice(0,1);""===f[f.length-1]&&(f=f.splice(f.length-1,1));l=f.length;p=g.match(x);n=[];if(p)for(var w=t=0;w<l;w++)p=f[w].match(x)?f[w]:void 0,void 0!==p?(p=p.substr(1,p.length-2),n.push(p),s[p]=void 0,t++):n.push(void 0);k[v]=
{event:q[v],route:g,len:l,split:f,variables:n,varkeys:s}}j=k}b.el=e;b.name=a;b.start=function(){b.trigger("Starting");var a=function(a){var c=a.substr(1,a.length-1),d;if(""===a)d={key:"Default",variables:{}};else a:{a=j;var c=c.split("/"),e=!1,f={},h;""===c[0]&&c.splice(0,1);""===c[c.length-1]&&(c=c.splice(0,c.length-1));h=c.length;for(d in a)if(a.hasOwnProperty(d)){if(h===a[d].len){for(var e=!0,g=0;g<h;g++)c[g].toLowerCase()!==a[d].split[g].toLowerCase()&&(e=!1);if(!1===e)for(g=0;g<h;g++)c[g].toLowerCase()===
a[d].split[g].toLowerCase()||void 0!==a[d].variables[g]?(void 0!==a[d].variables[g]&&(f[a[d].variables[g]]=c[g]),e=!0):e=!1}if(!0===e){d={key:a[d].event,variables:f};break a}}d=!1}b.trigger("Router:BeforeRouter");b.trigger("Router:"+d.key,d.variables)};if("onhashchange"in window)window.onhashchange=function(){a(window.location.hash)};else{var c=window.location.hash,e;window.setInterval(function(){window.location.hash!=c&&(e=window.location.hash,a(e))},100)}a(window.location.hash);b.on("a:click",function(a,
c){var b;b=c.url;b="string"===d(b)?b:null;var e="";b?("#"!==b.charAt(0)&&"/"!==b.charAt(0)?e="#/"+b:"/"===b.charAt(0)?e="#"+b:"#"===b.charAt(0)&&"/"!==b.charAt(1)?(e=b.substring(b.length,2),e="#/"+e):e=b,b=e):b=null;e=c.el;b&&"false"!==e.attr("data-coreroute")&&(window.location=b)});return b};b.config=c;c.Api&&(b.Api=new m.Api(c.Api));"boolean"!==d(c.routerOverrideLinks)&&(c.routerOverrideLinks=!0);b._={saveTemplate:function(a,b){var c=h.get()[0];"object"!==d(c)&&(c={});c[a]=b;h.add(c)},getTemplate:function(a){var b=
h.get()[0];if("object"===d(b))return b[a]}};if(!0===c.routerOverrideLinks)e.on("click",function(a){var c=a.target,d=$(c),e=/(https?:\/\/[^\s]+)/g,f="";if("a"===c.nodeName||"A"===c.nodeName)f=d.attr("href"),f.match(e)?1===f.match(e).length&&(window.location=f):(a.preventDefault(),b.trigger("a:click",{el:d,url:f}))});return b},version:"0.2.8c"};"function"===typeof define&&define.amd?define("Core",[],function(){return m}):"undefined"!==typeof module&&"undefined"!==typeof exports&&module.exports?module.exports=
m:y["string"===typeof t?t:"Core"]=m})(this,"$$");
